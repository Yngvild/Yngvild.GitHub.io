<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Age-structured matrix population models | Demographic methods in life history theory</title>
  <meta name="description" content="3 Age-structured matrix population models | Demographic methods in life history theory" />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Age-structured matrix population models | Demographic methods in life history theory" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Age-structured matrix population models | Demographic methods in life history theory" />
  
  
  

<meta name="author" content="Yngvild Vindenes (yngvild.vindenes@ibv.uio.no)" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="s02-life-tables.html"/>
<link rel="next" href="s04-Stage.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="s01-Exponential.html"><a href="s01-Exponential.html"><i class="fa fa-check"></i><b>1</b> Exponential growth</a>
<ul>
<li class="chapter" data-level="1.1" data-path="s01-Exponential.html"><a href="s01-Exponential.html#learning-goals"><i class="fa fa-check"></i><b>1.1</b> Learning goals</a></li>
<li class="chapter" data-level="1.2" data-path="s01-Exponential.html"><a href="s01-Exponential.html#the-exponential-growth-model"><i class="fa fa-check"></i><b>1.2</b> The exponential growth model</a></li>
<li class="chapter" data-level="1.3" data-path="s01-Exponential.html"><a href="s01-Exponential.html#exponential-growth-in-structured-populations"><i class="fa fa-check"></i><b>1.3</b> Exponential growth in structured populations</a></li>
<li class="chapter" data-level="1.4" data-path="s01-Exponential.html"><a href="s01-Exponential.html#the-role-of-exponential-growth-in-ecology-and-evolution"><i class="fa fa-check"></i><b>1.4</b> The role of exponential growth in ecology and evolution</a></li>
<li class="chapter" data-level="1.5" data-path="s01-Exponential.html"><a href="s01-Exponential.html#exercises"><i class="fa fa-check"></i><b>1.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="s01-Exponential.html"><a href="s01-Exponential.html#exercise-1.1"><i class="fa fa-check"></i>Exercise 1.1</a></li>
<li class="chapter" data-level="" data-path="s01-Exponential.html"><a href="s01-Exponential.html#exercise-1.2"><i class="fa fa-check"></i>Exercise 1.2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="s02-life-tables.html"><a href="s02-life-tables.html"><i class="fa fa-check"></i><b>2</b> Life tables</a>
<ul>
<li class="chapter" data-level="2.1" data-path="s02-life-tables.html"><a href="s02-life-tables.html#learning-goals-1"><i class="fa fa-check"></i><b>2.1</b> Learning goals</a></li>
<li class="chapter" data-level="2.2" data-path="s02-life-tables.html"><a href="s02-life-tables.html#age-specific-survival-and-fecundity"><i class="fa fa-check"></i><b>2.2</b> Age-specific survival and fecundity</a></li>
<li class="chapter" data-level="2.3" data-path="s02-life-tables.html"><a href="s02-life-tables.html#life-history-strategies-and-trade-offs"><i class="fa fa-check"></i><b>2.3</b> Life history strategies and trade-offs</a></li>
<li class="chapter" data-level="2.4" data-path="s02-life-tables.html"><a href="s02-life-tables.html#a-basic-life-table"><i class="fa fa-check"></i><b>2.4</b> A basic life table</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="s02-life-tables.html"><a href="s02-life-tables.html#bird"><i class="fa fa-check"></i><b>2.4.1</b> Songbird example</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="s02-life-tables.html"><a href="s02-life-tables.html#dynamic-and-static-life-tables"><i class="fa fa-check"></i><b>2.5</b> Dynamic and static life tables</a></li>
<li class="chapter" data-level="2.6" data-path="s02-life-tables.html"><a href="s02-life-tables.html#life-table-calculations"><i class="fa fa-check"></i><b>2.6</b> Life table calculations</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="s02-life-tables.html"><a href="s02-life-tables.html#net-reproductive-rate"><i class="fa fa-check"></i><b>2.6.1</b> Net reproductive rate</a></li>
<li class="chapter" data-level="2.6.2" data-path="s02-life-tables.html"><a href="s02-life-tables.html#cohort-generation-time"><i class="fa fa-check"></i><b>2.6.2</b> Cohort generation time</a></li>
<li class="chapter" data-level="2.6.3" data-path="s02-life-tables.html"><a href="s02-life-tables.html#approximation-of-long-term-growth-rate"><i class="fa fa-check"></i><b>2.6.3</b> Approximation of long-term growth rate</a></li>
<li class="chapter" data-level="2.6.4" data-path="s02-life-tables.html"><a href="s02-life-tables.html#Euler"><i class="fa fa-check"></i><b>2.6.4</b> Euler-lotka equation</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="s02-life-tables.html"><a href="s02-life-tables.html#fitness-measures-in-life-history-theory"><i class="fa fa-check"></i><b>2.7</b> Fitness measures in life history theory</a></li>
<li class="chapter" data-level="2.8" data-path="s02-life-tables.html"><a href="s02-life-tables.html#semelparity-and-iteroparity"><i class="fa fa-check"></i><b>2.8</b> Semelparity and iteroparity</a></li>
<li class="chapter" data-level="2.9" data-path="s02-life-tables.html"><a href="s02-life-tables.html#the-lack-clutch"><i class="fa fa-check"></i><b>2.9</b> The Lack clutch</a></li>
<li class="chapter" data-level="2.10" data-path="s02-life-tables.html"><a href="s02-life-tables.html#exercises-1"><i class="fa fa-check"></i><b>2.10</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="s02-life-tables.html"><a href="s02-life-tables.html#exercise-2.1"><i class="fa fa-check"></i>Exercise 2.1</a></li>
<li class="chapter" data-level="" data-path="s02-life-tables.html"><a href="s02-life-tables.html#exercise-2.2"><i class="fa fa-check"></i>Exercise 2.2</a></li>
<li class="chapter" data-level="" data-path="s02-life-tables.html"><a href="s02-life-tables.html#exercise-2.3"><i class="fa fa-check"></i>Exercise 2.3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="s03-MatrixModels.html"><a href="s03-MatrixModels.html"><i class="fa fa-check"></i><b>3</b> Age-structured matrix population models</a>
<ul>
<li class="chapter" data-level="3.1" data-path="s03-MatrixModels.html"><a href="s03-MatrixModels.html#learning-goals-2"><i class="fa fa-check"></i><b>3.1</b> Learning goals</a></li>
<li class="chapter" data-level="3.2" data-path="s03-MatrixModels.html"><a href="s03-MatrixModels.html#age-structured-growth"><i class="fa fa-check"></i><b>3.2</b> Age-structured growth</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="s03-MatrixModels.html"><a href="s03-MatrixModels.html#LeslieR"><i class="fa fa-check"></i><b>3.2.1</b> Creating a Leslie matrix in R</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="s03-MatrixModels.html"><a href="s03-MatrixModels.html#census"><i class="fa fa-check"></i><b>3.3</b> Pre- and post-reproductive census</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="s03-MatrixModels.html"><a href="s03-MatrixModels.html#pre-reproductive-census"><i class="fa fa-check"></i><b>3.3.1</b> Pre-reproductive census</a></li>
<li class="chapter" data-level="3.3.2" data-path="s03-MatrixModels.html"><a href="s03-MatrixModels.html#post-reproductive-census"><i class="fa fa-check"></i><b>3.3.2</b> Post-reproductive census</a></li>
<li class="chapter" data-level="3.3.3" data-path="s03-MatrixModels.html"><a href="s03-MatrixModels.html#avoiding-mistakes"><i class="fa fa-check"></i><b>3.3.3</b> Avoiding mistakes</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="s03-MatrixModels.html"><a href="s03-MatrixModels.html#life-cycle-graph"><i class="fa fa-check"></i><b>3.4</b> Life cycle graph</a></li>
<li class="chapter" data-level="3.5" data-path="s03-MatrixModels.html"><a href="s03-MatrixModels.html#projected-growth"><i class="fa fa-check"></i><b>3.5</b> Projected growth</a></li>
<li class="chapter" data-level="3.6" data-path="s03-MatrixModels.html"><a href="s03-MatrixModels.html#asymptotic"><i class="fa fa-check"></i><b>3.6</b> Asymptotic properties</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="s03-MatrixModels.html"><a href="s03-MatrixModels.html#projected"><i class="fa fa-check"></i><b>3.6.1</b> Calculations based on projected growth</a></li>
<li class="chapter" data-level="3.6.2" data-path="s03-MatrixModels.html"><a href="s03-MatrixModels.html#eigen"><i class="fa fa-check"></i><b>3.6.2</b> Calculations based on projection matrix</a></li>
<li class="chapter" data-level="3.6.3" data-path="s03-MatrixModels.html"><a href="s03-MatrixModels.html#lifetime"><i class="fa fa-check"></i><b>3.6.3</b> Life expectancy</a></li>
<li class="chapter" data-level="3.6.4" data-path="s03-MatrixModels.html"><a href="s03-MatrixModels.html#netrate"><i class="fa fa-check"></i><b>3.6.4</b> Lifetime reproduction</a></li>
<li class="chapter" data-level="3.6.5" data-path="s03-MatrixModels.html"><a href="s03-MatrixModels.html#gentime"><i class="fa fa-check"></i><b>3.6.5</b> Generation time</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="s03-MatrixModels.html"><a href="s03-MatrixModels.html#sensitivity-and-elasticity-of-lambda"><i class="fa fa-check"></i><b>3.7</b> Sensitivity and elasticity of <span class="math inline">\(\lambda\)</span></a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="s03-MatrixModels.html"><a href="s03-MatrixModels.html#sensitivity-to-matrix-elements"><i class="fa fa-check"></i><b>3.7.1</b> Sensitivity to matrix elements</a></li>
<li class="chapter" data-level="3.7.2" data-path="s03-MatrixModels.html"><a href="s03-MatrixModels.html#sensitivity-to-underlying-parameters"><i class="fa fa-check"></i><b>3.7.2</b> Sensitivity to underlying parameters</a></li>
<li class="chapter" data-level="3.7.3" data-path="s03-MatrixModels.html"><a href="s03-MatrixModels.html#elasticities"><i class="fa fa-check"></i><b>3.7.3</b> Elasticities</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="s03-MatrixModels.html"><a href="s03-MatrixModels.html#senescence"><i class="fa fa-check"></i><b>3.8</b> Senescence</a>
<ul>
<li class="chapter" data-level="" data-path="s03-MatrixModels.html"><a href="s03-MatrixModels.html#the-effect-of-extrinsic-mortality-on-senescence"><i class="fa fa-check"></i>The effect of extrinsic mortality on senescence</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="s03-MatrixModels.html"><a href="s03-MatrixModels.html#LTRE"><i class="fa fa-check"></i><b>3.9</b> Life table response experiments (LTRE)</a>
<ul>
<li class="chapter" data-level="3.9.1" data-path="s03-MatrixModels.html"><a href="s03-MatrixModels.html#general-description-of-ltre-approach"><i class="fa fa-check"></i><b>3.9.1</b> General description of LTRE approach</a></li>
<li class="chapter" data-level="3.9.2" data-path="s03-MatrixModels.html"><a href="s03-MatrixModels.html#ltre-and-sensitivity-analyses"><i class="fa fa-check"></i><b>3.9.2</b> LTRE and sensitivity analyses</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="s03-MatrixModels.html"><a href="s03-MatrixModels.html#exercises-2"><i class="fa fa-check"></i><b>3.10</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="s03-MatrixModels.html"><a href="s03-MatrixModels.html#exercise-3.1"><i class="fa fa-check"></i>Exercise 3.1</a></li>
<li class="chapter" data-level="" data-path="s03-MatrixModels.html"><a href="s03-MatrixModels.html#exercise-3.2"><i class="fa fa-check"></i>Exercise 3.2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="s04-Stage.html"><a href="s04-Stage.html"><i class="fa fa-check"></i><b>4</b> Stage structured models</a>
<ul>
<li class="chapter" data-level="4.1" data-path="s04-Stage.html"><a href="s04-Stage.html#learning-goals-3"><i class="fa fa-check"></i><b>4.1</b> Learning goals</a></li>
<li class="chapter" data-level="4.2" data-path="s04-Stage.html"><a href="s04-Stage.html#general-stage-structured-matrix-model"><i class="fa fa-check"></i><b>4.2</b> General stage structured matrix model</a></li>
<li class="chapter" data-level="4.3" data-path="s04-Stage.html"><a href="s04-Stage.html#decomposing-mathbfu-and-mathbff"><i class="fa fa-check"></i><b>4.3</b> Decomposing <span class="math inline">\(\mathbf{U}\)</span> and <span class="math inline">\(\mathbf{F}\)</span></a></li>
<li class="chapter" data-level="4.4" data-path="s04-Stage.html"><a href="s04-Stage.html#examples-of-stage-structured-models"><i class="fa fa-check"></i><b>4.4</b> Examples of stage structured models</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="s04-Stage.html"><a href="s04-Stage.html#lefkovitch-models"><i class="fa fa-check"></i><b>4.4.1</b> Lefkovitch models</a></li>
<li class="chapter" data-level="4.4.2" data-path="s04-Stage.html"><a href="s04-Stage.html#agestage"><i class="fa fa-check"></i><b>4.4.2</b> Age by stage models</a></li>
<li class="chapter" data-level="4.4.3" data-path="s04-Stage.html"><a href="s04-Stage.html#disease-models"><i class="fa fa-check"></i><b>4.4.3</b> Disease models</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="s04-Stage.html"><a href="s04-Stage.html#integral-projection-models-ipms"><i class="fa fa-check"></i><b>4.5</b> Integral projection models (IPMs)</a></li>
<li class="chapter" data-level="4.6" data-path="s04-Stage.html"><a href="s04-Stage.html#exercises-3"><i class="fa fa-check"></i><b>4.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="s04-Stage.html"><a href="s04-Stage.html#exercise-4.1"><i class="fa fa-check"></i>Exercise 4.1</a></li>
<li class="chapter" data-level="" data-path="s04-Stage.html"><a href="s04-Stage.html#exercise-4.2"><i class="fa fa-check"></i>Exercise 4.2</a></li>
<li class="chapter" data-level="" data-path="s04-Stage.html"><a href="s04-Stage.html#exercise-4.3"><i class="fa fa-check"></i>Exercise 4.3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="Stochasticity.html"><a href="Stochasticity.html"><i class="fa fa-check"></i><b>5</b> Stochasticity</a>
<ul>
<li class="chapter" data-level="5.1" data-path="Stochasticity.html"><a href="Stochasticity.html#learning-goals-4"><i class="fa fa-check"></i><b>5.1</b> Learning goals</a></li>
<li class="chapter" data-level="5.2" data-path="Stochasticity.html"><a href="Stochasticity.html#variable-vs-unpredictable-environments"><i class="fa fa-check"></i><b>5.2</b> Variable vs unpredictable environments</a></li>
<li class="chapter" data-level="5.3" data-path="Stochasticity.html"><a href="Stochasticity.html#the-lewontin-cohen-model"><i class="fa fa-check"></i><b>5.3</b> The Lewontin-Cohen model</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="Stochasticity.html"><a href="Stochasticity.html#defining-the-process"><i class="fa fa-check"></i><b>5.3.1</b> Defining the process</a></li>
<li class="chapter" data-level="5.3.2" data-path="Stochasticity.html"><a href="Stochasticity.html#the-stochastic-growth-rate"><i class="fa fa-check"></i><b>5.3.2</b> The stochastic growth rate</a></li>
<li class="chapter" data-level="5.3.3" data-path="Stochasticity.html"><a href="Stochasticity.html#arithmetic-and-geometric-mean"><i class="fa fa-check"></i><b>5.3.3</b> Arithmetic and geometric mean</a></li>
<li class="chapter" data-level="5.3.4" data-path="Stochasticity.html"><a href="Stochasticity.html#bet-hedging"><i class="fa fa-check"></i><b>5.3.4</b> Bet-hedging</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="Stochasticity.html"><a href="Stochasticity.html#stochastic-growth-of-structured-populations"><i class="fa fa-check"></i><b>5.4</b> Stochastic growth of structured populations</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="Stochasticity.html"><a href="Stochasticity.html#defining-the-process-1"><i class="fa fa-check"></i><b>5.4.1</b> Defining the process</a></li>
<li class="chapter" data-level="" data-path="Stochasticity.html"><a href="Stochasticity.html#plot-one-realization-of-the-process-1"><i class="fa fa-check"></i>Plot one realization of the process</a></li>
<li class="chapter" data-level="" data-path="Stochasticity.html"><a href="Stochasticity.html#plot-many-realizations-of-the-process-1"><i class="fa fa-check"></i>Plot many realizations of the process</a></li>
<li class="chapter" data-level="" data-path="Stochasticity.html"><a href="Stochasticity.html#plot-percentiles-from-many-realizations-1"><i class="fa fa-check"></i>Plot percentiles from many realizations</a></li>
<li class="chapter" data-level="5.4.2" data-path="Stochasticity.html"><a href="Stochasticity.html#stochastic-growth-rate"><i class="fa fa-check"></i><b>5.4.2</b> Stochastic growth rate</a></li>
<li class="chapter" data-level="5.4.3" data-path="Stochasticity.html"><a href="Stochasticity.html#small-noise-approximation"><i class="fa fa-check"></i><b>5.4.3</b> Small noise approximation</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="Stochasticity.html"><a href="Stochasticity.html#exercises-4"><i class="fa fa-check"></i><b>5.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="Stochasticity.html"><a href="Stochasticity.html#exercise-5.1"><i class="fa fa-check"></i>Exercise 5.1</a></li>
<li class="chapter" data-level="" data-path="Stochasticity.html"><a href="Stochasticity.html#exercise-5.2"><i class="fa fa-check"></i>Exercise 5.2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="id_06-references.html"><a href="id_06-references.html"><i class="fa fa-check"></i>Bibliography</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="s09-Solutions.html"><a href="s09-Solutions.html"><i class="fa fa-check"></i><b>A</b> Suggested solutions to exercises</a>
<ul>
<li class="chapter" data-level="A.1" data-path="s09-Solutions.html"><a href="s09-Solutions.html#chapter-1-exercises"><i class="fa fa-check"></i><b>A.1</b> Chapter 1 exercises</a>
<ul>
<li class="chapter" data-level="" data-path="s09-Solutions.html"><a href="s09-Solutions.html#exercise-1.1-1"><i class="fa fa-check"></i>Exercise 1.1</a></li>
<li class="chapter" data-level="" data-path="s09-Solutions.html"><a href="s09-Solutions.html#exercise-1.2-1"><i class="fa fa-check"></i>Exercise 1.2</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="s09-Solutions.html"><a href="s09-Solutions.html#chapter-2-exercises"><i class="fa fa-check"></i><b>A.2</b> Chapter 2 exercises</a>
<ul>
<li class="chapter" data-level="" data-path="s09-Solutions.html"><a href="s09-Solutions.html#exercise-2.1-1"><i class="fa fa-check"></i>Exercise 2.1</a></li>
<li class="chapter" data-level="" data-path="s09-Solutions.html"><a href="s09-Solutions.html#exercise-2.2-1"><i class="fa fa-check"></i>Exercise 2.2</a></li>
<li class="chapter" data-level="" data-path="s09-Solutions.html"><a href="s09-Solutions.html#exercise-2.3-1"><i class="fa fa-check"></i>Exercise 2.3</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="s09-Solutions.html"><a href="s09-Solutions.html#chapter-3-exercises"><i class="fa fa-check"></i><b>A.3</b> Chapter 3 exercises</a>
<ul>
<li class="chapter" data-level="" data-path="s09-Solutions.html"><a href="s09-Solutions.html#exercise-3.1-1"><i class="fa fa-check"></i>Exercise 3.1</a></li>
<li class="chapter" data-level="" data-path="s09-Solutions.html"><a href="s09-Solutions.html#exercise-3.2-1"><i class="fa fa-check"></i>Exercise 3.2</a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="s09-Solutions.html"><a href="s09-Solutions.html#chapter-4-exercises"><i class="fa fa-check"></i><b>A.4</b> Chapter 4 exercises</a>
<ul>
<li class="chapter" data-level="" data-path="s09-Solutions.html"><a href="s09-Solutions.html#exercise-4.1-1"><i class="fa fa-check"></i>Exercise 4.1</a></li>
<li class="chapter" data-level="" data-path="s09-Solutions.html"><a href="s09-Solutions.html#exercise-4.2-1"><i class="fa fa-check"></i>Exercise 4.2</a></li>
<li class="chapter" data-level="" data-path="s09-Solutions.html"><a href="s09-Solutions.html#exercise-4.3-1"><i class="fa fa-check"></i>Exercise 4.3</a></li>
</ul></li>
<li class="chapter" data-level="A.5" data-path="s09-Solutions.html"><a href="s09-Solutions.html#chapter-5-exercises"><i class="fa fa-check"></i><b>A.5</b> Chapter 5 exercises</a>
<ul>
<li class="chapter" data-level="" data-path="s09-Solutions.html"><a href="s09-Solutions.html#exercise-5.1-1"><i class="fa fa-check"></i>Exercise 5.1</a></li>
<li class="chapter" data-level="" data-path="s09-Solutions.html"><a href="s09-Solutions.html#exercise-5.2-1"><i class="fa fa-check"></i>Exercise 5.2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="s07-Code-Collection.html"><a href="s07-Code-Collection.html"><i class="fa fa-check"></i><b>B</b> R code collection</a>
<ul>
<li class="chapter" data-level="B.1" data-path="s07-Code-Collection.html"><a href="s07-Code-Collection.html#life-tables"><i class="fa fa-check"></i><b>B.1</b> Life tables</a>
<ul>
<li class="chapter" data-level="B.1.1" data-path="s07-Code-Collection.html"><a href="s07-Code-Collection.html#net-reproductive-rate-r_0"><i class="fa fa-check"></i><b>B.1.1</b> Net reproductive rate <span class="math inline">\(R_0\)</span></a></li>
<li class="chapter" data-level="B.1.2" data-path="s07-Code-Collection.html"><a href="s07-Code-Collection.html#euler-lotka"><i class="fa fa-check"></i><b>B.1.2</b> Euler-Lotka</a></li>
</ul></li>
<li class="chapter" data-level="B.2" data-path="s07-Code-Collection.html"><a href="s07-Code-Collection.html#matrix-population-models"><i class="fa fa-check"></i><b>B.2</b> Matrix population models</a>
<ul>
<li class="chapter" data-level="B.2.1" data-path="s07-Code-Collection.html"><a href="s07-Code-Collection.html#create-leslie-matrix"><i class="fa fa-check"></i><b>B.2.1</b> Create Leslie matrix</a></li>
<li class="chapter" data-level="B.2.2" data-path="s07-Code-Collection.html"><a href="s07-Code-Collection.html#decompose-mathbfu-and-mathbff"><i class="fa fa-check"></i><b>B.2.2</b> Decompose <span class="math inline">\(\mathbf{U}\)</span> and <span class="math inline">\(\mathbf{F}\)</span></a></li>
<li class="chapter" data-level="B.2.3" data-path="s07-Code-Collection.html"><a href="s07-Code-Collection.html#population-projection"><i class="fa fa-check"></i><b>B.2.3</b> Population projection</a></li>
<li class="chapter" data-level="B.2.4" data-path="s07-Code-Collection.html"><a href="s07-Code-Collection.html#long-term-growth-rate-stable-structure-and-reproductive-value"><i class="fa fa-check"></i><b>B.2.4</b> Long-term growth rate, stable structure and reproductive value</a></li>
<li class="chapter" data-level="B.2.5" data-path="s07-Code-Collection.html"><a href="s07-Code-Collection.html#life-expectancy"><i class="fa fa-check"></i><b>B.2.5</b> Life expectancy</a></li>
<li class="chapter" data-level="B.2.6" data-path="s07-Code-Collection.html"><a href="s07-Code-Collection.html#lifetime-reproduction"><i class="fa fa-check"></i><b>B.2.6</b> Lifetime reproduction</a></li>
<li class="chapter" data-level="B.2.7" data-path="s07-Code-Collection.html"><a href="s07-Code-Collection.html#generation-time"><i class="fa fa-check"></i><b>B.2.7</b> Generation time</a></li>
<li class="chapter" data-level="B.2.8" data-path="s07-Code-Collection.html"><a href="s07-Code-Collection.html#sensitivities-and-elasticities"><i class="fa fa-check"></i><b>B.2.8</b> Sensitivities and elasticities</a></li>
</ul></li>
<li class="chapter" data-level="B.3" data-path="s07-Code-Collection.html"><a href="s07-Code-Collection.html#stochastic-models"><i class="fa fa-check"></i><b>B.3</b> Stochastic models</a>
<ul>
<li class="chapter" data-level="B.3.1" data-path="s07-Code-Collection.html"><a href="s07-Code-Collection.html#arithmetic-and-geometric-mean-1"><i class="fa fa-check"></i><b>B.3.1</b> Arithmetic and geometric mean</a></li>
<li class="chapter" data-level="B.3.2" data-path="s07-Code-Collection.html"><a href="s07-Code-Collection.html#simulations-in-lewontin-cohen-model"><i class="fa fa-check"></i><b>B.3.2</b> Simulations in Lewontin-Cohen model</a></li>
<li class="chapter" data-level="B.3.3" data-path="s07-Code-Collection.html"><a href="s07-Code-Collection.html#simulations-of-stochastic-structured-model"><i class="fa fa-check"></i><b>B.3.3</b> Simulations of stochastic structured model</a></li>
<li class="chapter" data-level="B.3.4" data-path="s07-Code-Collection.html"><a href="s07-Code-Collection.html#estimate-stochastic-growth-rate"><i class="fa fa-check"></i><b>B.3.4</b> Estimate stochastic growth rate</a></li>
</ul></li>
<li class="chapter" data-level="B.4" data-path="s07-Code-Collection.html"><a href="s07-Code-Collection.html#parameters-and-matrices-for-the-songbird-example"><i class="fa fa-check"></i><b>B.4</b> Parameters and matrices for the songbird example</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Demographic methods in life history theory</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="s03-MatrixModels" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">3</span> Age-structured matrix population models<a href="s03-MatrixModels.html#s03-MatrixModels" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Matrix models make it possible to work with systems of multiple equations simultaneously, which is what we need to describe the growth of structured populations. For instance, if we study a long-lived species with 50 age classes, it is very cumbersome to write down the growth equations for all of the 50 age classes. With a matrix model we need only one equation to keep track of the growth of all of stages simultaneously.</p>
<p>This chapter will deal with age-structured matrix models and introduce methods for calculating key properties of life history and population growth. Chapter @ref{s04-stage} will introduce more general stage structured models, and we will see that the methods introduced here for age-structured populations are applicable also to these cases.</p>
<p>The main ‘ingredient’ of an age-structured matrix model is the Leslie matrix, which contains all the information necessary to project the growth of each age class over time. Several life history parameters can also be calculated directly from this matrix, including the long-term population growth rate <span class="math inline">\(\lambda\)</span>.
<br></p>
<div id="learning-goals-2" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Learning goals<a href="s03-MatrixModels.html#learning-goals-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><p>Define a Leslie matrix for age-structured populations, and its two main components.</p></li>
<li><p>Explain the differences between a pre- and post-reproductive census.</p></li>
<li><p>Show how a Leslie matrix is related to the life table.</p></li>
<li><p>Draw a life cycle graph and explain how it is related to the Leslie matrix.</p></li>
<li><p>Calculate asymptotic parameters from a matrix model (using projection or eigen analysis), and explain their biological meaning.</p></li>
<li><p>Calculate lifetime reproduction, generation time and life expectancy from the Leslie matrix and its main components.</p></li>
<li><p>Calculate sensitivities and elasticities of <span class="math inline">\(\lambda\)</span> with respect to projection matrix elements or underlying parameters.</p></li>
<li><p>Do an LTRE analysis to understand the difference in the long-term growth rate in two different environments.</p></li>
</ul>
<p><br></p>
</div>
<div id="age-structured-growth" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Age-structured growth<a href="s03-MatrixModels.html#age-structured-growth" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this section we will define the growth of each age class as a function of the annual survival probability and fertility, and introduce the matrix equation to describe this growth. In the next sections we will see how the age-structured matrix model is connected to life tables, and how it can be described by a life cycle graph. The last sections present important calculations that can be done with a matrix model.</p>
<p>We will denote the first class as class 1, the second as class 2, etc., but as we will see in section <a href="s03-MatrixModels.html#census">3.3</a>, the definition of the parameters of survival and reproduction depend on census time (when the population is counted within each time step). To keep track of the number of individuals in each of the age classes over time, we define the following <strong>population vector</strong> <span class="math inline">\(\mathbf{n}_t\)</span> of individuals in age class 1 to <span class="math inline">\(k\)</span>:</p>
<p><span class="math display" id="eq:popvec">\[\begin{align}
\mathbf{n}_t=\left[\begin{matrix} n_1(t) \\ n_2(t)\\ \vdots \\ n_k(t) \end{matrix} \right].
\tag{3.1}
\end{align}\]</span></p>
<p><br></p>
<p>The total population size at time <span class="math inline">\(t\)</span> is the sum of this vector, <span class="math inline">\(N_t=\sum_{j=1}^kn_j(t)\)</span> (note that we now use <span class="math inline">\(j\)</span> or <span class="math inline">\(i\)</span> as index instead of <span class="math inline">\(x\)</span>, following conventional notation for matrix models). Let <span class="math inline">\(s_j\)</span> describe the survival probability of individuals in age class <span class="math inline">\(j\)</span> to the next time step, and <span class="math inline">\(f_j\)</span> the number of offspring produced by each individual in age class <span class="math inline">\(j\)</span> that enter age class 1 at time <span class="math inline">\(t+1\)</span>. Importantly, <span class="math inline">\(s_j\)</span> and <span class="math inline">\(f_j\)</span> of the Leslie matrix are <em>not the same</em> as the age-specific survival probability <span class="math inline">\(p_j\)</span> and fecundity <span class="math inline">\(m_j\)</span> (see section <a href="s03-MatrixModels.html#census">3.3</a>).</p>
<p>The growth of age class 1 (offspring) from one time step to the next is then given by</p>
<p><span class="math display" id="eq:AgeGrowth1">\[\begin{equation}
n_1(t+1)=f_1n_1(t)+f_2n_2(t)+\ldots +f_kn_k(t),
\tag{3.2}
\end{equation}\]</span></p>
<p>while the growth of the other age classes is given by</p>
<p><span class="math display" id="eq:AgeGrowth2">\[\begin{align}
\begin{split}
n_2(t+1)&amp;=s_1n_1(t),\\
n_3(t+1)&amp;=s_2n_2(t),\\
\vdots \\
n_k(t+1)&amp;=s_{k-1}n_{k-1}(t).\\
\end{split}
\tag{3.3}
\end{align}\]</span></p>
<p><br></p>
<p>Together, theses equations constitute a system of linear equations, which we can describe with a matrix model:</p>
<p><span class="math display" id="eq:LeslieGrowth">\[\begin{align}
\begin{split}
\mathbf{n}_{t+1}&amp;=\mathbf{A}\mathbf{n}_t\\
\left[\begin{matrix} n_1 \\n_2 \\ \vdots \\  \\ n_k   \\  \end{matrix}\right]_{t+1}&amp;=\left[\begin{matrix} f_1 &amp; f_2 &amp;&amp; \cdots &amp; f_k \\ s_1 &amp;0 &amp;&amp; \cdots &amp;0\\ 0 &amp;s_2 &amp; &amp;\cdots &amp;0\\ \vdots&amp; &amp;\ddots&amp;&amp;\vdots\\ 0 &amp;\cdots&amp;0 &amp; s_{k-1} &amp;0  \\  \end{matrix}\right]\left[\begin{matrix} n_1 \\n_2 \\ \vdots \\  \\ n_k   \\  \end{matrix}\right]_{t}.
\end{split}
\tag{3.4}
\end{align}\]</span></p>
<p><br></p>
<p>This is the age-structured version of the exponential growth model of an unstructured population (section <a href="s01-Exponential.html#s01-Exponential">1</a>). The matrix <span class="math inline">\(\mathbf{A}\)</span> is a square matrix (same number of rows and columns), of dimension <span class="math inline">\(k \times k\)</span>, where <span class="math inline">\(k\)</span> is the number of age classes. It is named a <strong>Leslie matrix</strong> after the work of Leslie <span class="citation">(<a href="#ref-Leslie1" role="doc-biblioref">1945</a>, <a href="#ref-Leslie2" role="doc-biblioref">1948</a>)</span>, and the more general term which also applies to other kinds of structure is a <strong>projection matrix</strong>. The elements of the first row of <span class="math inline">\(\mathbf{A}\)</span> represent the production of offspring to next year’s population from each of the age classes. Here we refer to these elements as <strong>fertility coefficients</strong> or simply fertilities, while the <strong>survival coefficients</strong> are located along the sub-diagonal of the Leslie matrix. In the final age class, no individuals survive until the next time step, but individuals can reproduce and contribute with a number <span class="math inline">\(f_k\)</span> to next year’s age class 1.</p>
<p><br></p>
<p>The Leslie matrix can be decomposed as the sum of a <strong>survival matrix</strong> <span class="math inline">\(\mathbf{U}\)</span> and a <strong>fertility matrix</strong> <span class="math inline">\(\mathbf{F}\)</span>:</p>
<p><span class="math display" id="eq:LeslieSplit">\[\begin{align}
\begin{split}
\mathbf{A}&amp;=\mathbf{U}+\mathbf{F}\\
\left[\begin{matrix} f_1 &amp; f_2 &amp;&amp; \cdots &amp; f_k \\ s_1 &amp;0 &amp;&amp; \cdots &amp;0\\ 0 &amp;s_2 &amp; &amp;\cdots &amp;0\\ \vdots&amp; &amp;\ddots&amp;&amp;\vdots\\ 0 &amp;\cdots&amp;0 &amp; s_{k-1} &amp;0  \\  \end{matrix}\right] &amp;= \left[\begin{matrix} 0 &amp; 0 &amp;&amp; \cdots &amp; 0 \\ s_1 &amp;0 &amp;&amp; \cdots &amp;0\\ 0 &amp;s_2 &amp; &amp;\cdots &amp;0\\ \vdots&amp; &amp;\ddots&amp;&amp;\vdots\\ 0 &amp;\cdots&amp;0 &amp; s_{k-1} &amp;0  \\  \end{matrix}\right] \left[\begin{matrix} f_1 &amp; f_2 &amp;&amp; \cdots &amp; f_k \\0  &amp;0 &amp;&amp; \cdots &amp;0\\ 0 &amp;0 &amp; &amp;\cdots &amp;0\\ \vdots&amp; &amp;\ddots&amp;&amp;\vdots\\ 0 &amp;\cdots&amp;0 &amp; 0 &amp;0  \\  \end{matrix} \right]
\end{split}
\tag{3.5}
\end{align}\]</span></p>
<p><br></p>
<p>These two sub-matrices are used in the calculations of the net reproductive rate <span class="math inline">\(R_0\)</span> and generation time <span class="math inline">\(G\)</span> (section <a href="s03-MatrixModels.html#asymptotic">3.6</a>). In chapter <a href="s04-Stage.html#s04-Stage">4</a> we will further decompose these two matrices into components describing survival, fertility and stage transitions.</p>
<p><br></p>
<div id="LeslieR" class="section level3 hasAnchor" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Creating a Leslie matrix in R<a href="s03-MatrixModels.html#LeslieR" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The following R function creates a Leslie matrix from vectors of survival <span class="math inline">\(\mathbf{s}\)</span> and fertility <span class="math inline">\(\mathbf{f}\)</span> (the vectors must have the same length, corresponding to the number of age classes). The final element of the survival vector should be 0 if the model is purely age-structured (otherwise, individuals are allowed to accumulate in the final class, which is a commonly used extension of age structured models).</p>
<p><br></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="s03-MatrixModels.html#cb10-1" aria-hidden="true" tabindex="-1"></a>Create.Amat <span class="ot">&lt;-</span> <span class="cf">function</span>(Svec, Fvec){</span>
<span id="cb10-2"><a href="s03-MatrixModels.html#cb10-2" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="fu">length</span>(Svec)</span>
<span id="cb10-3"><a href="s03-MatrixModels.html#cb10-3" aria-hidden="true" tabindex="-1"></a>  MatA<span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>,k,k)</span>
<span id="cb10-4"><a href="s03-MatrixModels.html#cb10-4" aria-hidden="true" tabindex="-1"></a>  MatA[<span class="dv">1</span>,] <span class="ot">&lt;-</span> Fvec </span>
<span id="cb10-5"><a href="s03-MatrixModels.html#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(k<span class="dv">-1</span>)){</span>
<span id="cb10-6"><a href="s03-MatrixModels.html#cb10-6" aria-hidden="true" tabindex="-1"></a>    MatA[i<span class="sc">+</span><span class="dv">1</span>,i] <span class="ot">&lt;-</span> Svec[i]</span>
<span id="cb10-7"><a href="s03-MatrixModels.html#cb10-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-8"><a href="s03-MatrixModels.html#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Individuals can accumulate if Svec[k]&gt;0:</span></span>
<span id="cb10-9"><a href="s03-MatrixModels.html#cb10-9" aria-hidden="true" tabindex="-1"></a>  MatA[k,k] <span class="ot">&lt;-</span> Svec[k] </span>
<span id="cb10-10"><a href="s03-MatrixModels.html#cb10-10" aria-hidden="true" tabindex="-1"></a>  MatA</span>
<span id="cb10-11"><a href="s03-MatrixModels.html#cb10-11" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div>
<p><br></p>
</div>
</div>
<div id="census" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Pre- and post-reproductive census<a href="s03-MatrixModels.html#census" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The Leslie matrix depends on coefficients of fertility, <span class="math inline">\(f_j\)</span>, and survival probabilities <span class="math inline">\(s_j\)</span>. How these coefficients are linked to the life table depends on the <em>census type</em> of the matrix model, in other words at what time point the population is counted during each time step For a birth-pulse population (where individuals reproduce once per time step), there are two main census types: Pre- and post-reproductive* census. As the names indicate, they assume that the population is counted either right before (pre) or right after (post) reproduction.</p>
<p>Census time is important because a lot can happen to a population also within the time intervals of the model. The age-specific parameters describing fecundity (<span class="math inline">\(m_x\)</span>) and survival (<span class="math inline">\(l_x\)</span>, <span class="math inline">\(p_x\)</span>) as a function of actual age <span class="math inline">\(x\)</span> are the same regardless of census time. But the fertility and survival coefficients of the Leslie matrix (<span class="math inline">\(s_j\)</span>, <span class="math inline">\(f_j\)</span>) will be different depending on census - see definitions below.</p>
<p>In general, the size of age class 1 is larger in the post-reproductive census than with pre-reproductive, because individuals in this class are newborn. For any age-structured population with a positive growth rate, the stable age structure (proportion of individuals of each age) will always decline with age.</p>
<p>We assume that the population reproduces only once per year. But different species can have very different modes of reproduction, depending on their life history and environments. Some tropical species can reproduce at all times through the year. Bacteria also reproduce (divide) continuously. Other species can have more than one reproductive events each season, or reproduce only every other season (or even more rarely). It is possible to account for these different types of reproductive mode in a matrix model <span class="citation">(<a href="#ref-Caswell1" role="doc-biblioref">Hal Caswell 2001</a>)</span>, but that requires a different way to estimate the age-specific survival and fertility coefficients, which is beyond the scope of this course.</p>
<p>Below we go through the parameters of a pre- and post-reproductive census in more detail, using the bird example.</p>
<p><br></p>
<div id="pre-reproductive-census" class="section level3 hasAnchor" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Pre-reproductive census<a href="s03-MatrixModels.html#pre-reproductive-census" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><br></p>
<div class="figure"><span style="display:block;" id="fig:fig3"></span>
<img src="SurvFecPreRep2.jpg" alt="Overview of the timing of different events of survival and reproduction within each time step, for a pre-reproductive census." width="100%" />
<p class="caption">
Figure 3.1: Overview of the timing of different events of survival and reproduction within each time step, for a pre-reproductive census.
</p>
</div>
<p><br></p>
<p>With a <strong>pre-reproductive census</strong>, offspring will be nearly 1 year old when counted, and age classes correspond to the actual age at counting (e.g. individuals in age class 1 are 1 year old when counted), so that <span class="math inline">\(s_j=p_j\)</span>. The fertility coefficients are then given by <span class="math inline">\(f_j=p_0m_j\)</span>, the product of the fecundity <span class="math inline">\(m_j\)</span> and the first year survival probability <span class="math inline">\(p_0\)</span>.</p>
<p><br></p>
<div id="bird-example-4" class="section level4 unnumbered hasAnchor">
<h4>Bird example<a href="s03-MatrixModels.html#bird-example-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Using the bird example introduced in section <a href="s02-life-tables.html#bird">2.4.1</a>, the Leslie matrix for a pre-reproductive census is given by</p>
<p><br></p>
<p><span class="math display" id="eq:Prerep">\[\begin{align}
\begin{split}
\mathbf{A}=\left[\begin{matrix} f_1 &amp; f_2 &amp;f_3  \\ s_1 &amp;0&amp;0\\ 0 &amp; s_2 &amp;0  \\  \end{matrix}\right]=\left[\begin{matrix} 0 &amp; p_0m_2 &amp;p_0m_3  \\ p_1 &amp;0&amp;0\\ 0 &amp; p_2 &amp;0  \\  \end{matrix}\right]=\left[\begin{matrix} 0 &amp;0.6 &amp;1.2  \\ 0.9 &amp;0&amp;0\\ 0 &amp; 0.6 &amp;0  \\  \end{matrix}\right].
\end{split}
\tag{3.6}
\end{align}\]</span></p>
<p><br></p>
<p>The classes of this matrix corresponds to age 1, 2, and 3. We do not ‘see’ the 0-year olds in the matrix model, but the survival probability <span class="math inline">\(p_0\)</span> enters the fertility coefficients.</p>
<p>In R, we can define the matrix as follows:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="s03-MatrixModels.html#cb11-1" aria-hidden="true" tabindex="-1"></a>Abird.pre <span class="ot">&lt;-</span> <span class="fu">Create.Amat</span>(Svec <span class="ot">&lt;-</span> <span class="fu">c</span>(.<span class="dv">9</span>, .<span class="dv">6</span>, <span class="dv">0</span>), <span class="at">Fvec=</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">6</span>, <span class="fl">1.2</span>))  </span></code></pre></div>
<p><br></p>
</div>
</div>
<div id="post-reproductive-census" class="section level3 hasAnchor" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Post-reproductive census<a href="s03-MatrixModels.html#post-reproductive-census" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="figure"><span style="display:block;" id="fig:fig4"></span>
<img src="SurvFecPostRep2.jpg" alt="Overview of the timing of different events of survival and reproduction within each time step, for a post-reproductive census." width="100%" />
<p class="caption">
Figure 3.2: Overview of the timing of different events of survival and reproduction within each time step, for a post-reproductive census.
</p>
</div>
<p><br></p>
<p>With a <strong>post-reproductive census</strong>, the population is counted right after reproduction. In this case, age class 1 consists of newborn individuals (age 0), and individuals in age class <span class="math inline">\(j\)</span> have the actual age <span class="math inline">\(j-1\)</span>, so that <span class="math inline">\(s_j=p_{j-1}\)</span>. The fertility coefficient <span class="math inline">\(f_j\)</span> now depends on survival of the parent from last time step <span class="math inline">\(s_{j-1}\)</span>, and on fecundity <span class="math inline">\(m_{j}\)</span> of the age <span class="math inline">\(j\)</span>, since individuals reproduce right before next census. Thus, the fertility coefficient of the Leslie matrix is now <span class="math inline">\(f_j=p_{j-1}m_{j}\)</span>. This definition of fertilities can be counter-intuitive, as the contribution from a given age class <span class="math inline">\(j\)</span> to next year’s offspring depends on survival from the previous (actual) age <span class="math inline">\(p_{j-1}\)</span>.</p>
<p><br></p>
<div id="bird-example-5" class="section level4 unnumbered hasAnchor">
<h4>Bird example<a href="s03-MatrixModels.html#bird-example-5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For the bird example, we get the following Leslie matrix with post-reproductive census:</p>
<p><br></p>
<p><span class="math display" id="eq:Postrep">\[\begin{align}
\begin{split}
\mathbf{A}=\left[\begin{matrix} f_1 &amp; f_2 &amp;f_3  \\ s_1 &amp;0&amp;0\\ 0 &amp; s_2 &amp;0  \\  \end{matrix}\right]=\left[\begin{matrix} 0 &amp; p_1m_2 &amp;p_2m_3  \\ p_0 &amp;0&amp;0\\ 0 &amp; p_1 &amp;0  \\  \end{matrix}\right]=\left[\begin{matrix} 0 &amp;2.7 &amp;3.6  \\ 0.2 &amp;0&amp;0\\ 0 &amp; 0.9 &amp;0  \\  \end{matrix}\right].
\end{split}
\tag{3.7}
\end{align}\]</span></p>
<p><br></p>
<p>Note that each class of this matrix corresponds to age 0, 1, and 2. Thus, in this case we do not ‘see’ the 3-year olds as a separate class, but their fecundity defines fertility coefficient in the third class.</p>
<p>In R, we can define this matrix as follows:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="s03-MatrixModels.html#cb12-1" aria-hidden="true" tabindex="-1"></a>Abird.post <span class="ot">&lt;-</span> <span class="fu">Create.Amat</span>(Svec <span class="ot">&lt;-</span> <span class="fu">c</span>(.<span class="dv">2</span>, .<span class="dv">9</span>, <span class="dv">0</span>), <span class="at">Fvec=</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">2.7</span>, <span class="fl">3.6</span>))  </span></code></pre></div>
<p><br></p>
</div>
</div>
<div id="avoiding-mistakes" class="section level3 hasAnchor" number="3.3.3">
<h3><span class="header-section-number">3.3.3</span> Avoiding mistakes<a href="s03-MatrixModels.html#avoiding-mistakes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>It turns out that mistakes in constructing the projection matrix are quite common in the ecological literature <span class="citation">(<a href="#ref-Kendall8" role="doc-biblioref">Kendall et al. 2019</a>)</span>, and issues with census time often play a role here. Mistakes are easily made, since keeping track of age classes versus actual age requires accurate ‘book-keeping’, especially with a post-reproductive census. Mistakes are also more common for post-reproductive census models than pre-reproductive census models <span class="citation">(<a href="#ref-Kendall8" role="doc-biblioref">Kendall et al. 2019</a>)</span>.</p>
<p>Contributing to the confusion, the terminology of matrix models is not consistent in the literature. For instance, what we have defined as the ‘fertility coefficients’ <span class="math inline">\(f_j\)</span> is by some authors referred to as ‘fecundity’ (<span class="math inline">\(m_j\)</span> in our notation). Therefore, some authors mistakenly did not include survival in their fertility coefficients. Finally, there is no general consensus on whether to use 0 or 1 as index for the first age class when a post-reproductive census is used (note that we always use 1 as the index, regardless of census time), and this choice can affect the limits and indexing in different calculations (e.g. the Euler-Lotka equation).</p>
<p>The main recommendation to avoid such errors when constructing a matrix model, is to take your time and make sure you have defined each element of the matrix model and its biological meaning. One way to double check that you have obtained the right coefficients is to compare a pre- and post-reproductive census model and Leslie matrix, and check that <span class="math inline">\(\lambda\)</span> calculated from the matrix (section<a href="s03-MatrixModels.html#asymptotic">3.6</a>) is the same for the two cases. If it differs, at least one of the models has an error. It can also be helpful to draw a life cycle graph (see section <a href="s03-MatrixModels.html#life-cycle-graph">3.4</a>).</p>
<p>The long-term population growth rate <span class="math inline">\(\lambda\)</span> should be the same regardless of census time, and for age structured models the same is true for <span class="math inline">\(R_0\)</span> and generation time <span class="math inline">\(G\)</span> (section<a href="s03-MatrixModels.html#asymptotic">3.6</a>). But other properties will change between census times, such as the stable stage structure and reproductive value. The difference can be large, since many changes can occur within time steps. This is particularly true for species producing a many offspring per reproductive event, with low offspring survival. A female cod, for instance, can produce millions of eggs, but only a few will survive the first year. If we count a cod population right after spawning (post-reproductive census), the fertilized eggs would constitute a very high proportion of the population (practically the entire population). If we instead counted the population right before spawning (pre-reproductive census), the proportion of age 1 offspring would not be as high.</p>
<p><br></p>
</div>
</div>
<div id="life-cycle-graph" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Life cycle graph<a href="s03-MatrixModels.html#life-cycle-graph" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><br></p>
<center>
<div class="figure"><span style="display:block;" id="fig:Birdfig"></span>
<img src="LifeCycleAgePRE.jpg" alt="Life cycle graph for the songbird example, with a pre-reproductive census." width="60%" />
<p class="caption">
Figure 3.3: Life cycle graph for the songbird example, with a pre-reproductive census.
</p>
</div>
</center>
<p><br></p>
<p>A structured model can be represented in different ways. You have already seen two examples for age-structured populations: A life table and a matrix model. A third representation, which is a helpful visual tool, is the life cycle graph. This is particularly useful for more complex structures than age structure, with many possible transitions among stages. For age structured popualtoins it can be a useful tool to keep track of parameters for the different census times.</p>
<p>A life cycle graph gives an overview of the possible transitions among age classes each time step. For age structured populations, these transitions are quite simple, as they only consist of of survival from one age class to the next, and reproductive contributions from each age class to next year’s offspring.</p>
<p>Figure <a href="s03-MatrixModels.html#fig:Birdfig">3.3</a> shows the life cycle graph for the bird example introduced in section <a href="s02-life-tables.html#bird">2.4.1</a>, for a pre-reproductive census. Each circle represent one age class of the matrix model, and since this is pre-reproductive census age class 1 consists of individuals at age 1, etc. The circles are connected by arrows representing survival and reproduction. Comparing the life cycle graph to the Leslie matrix described before (equation <a href="s03-MatrixModels.html#eq:Prerep">(3.6)</a>), we see how the transitions are represented in the projection matrix.</p>
<p><br></p>
</div>
<div id="projected-growth" class="section level2 hasAnchor" number="3.5">
<h2><span class="header-section-number">3.5</span> Projected growth<a href="s03-MatrixModels.html#projected-growth" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The simplest application of a projection matrix is to use it to project the growth of each age class over time, from some given initial population vector <span class="math inline">\(\mathbf{n}_0\)</span> to a desired number of time steps <span class="math inline">\(T_{max}\)</span>. The following R function performs such a projection for a given Leslie matrix <span class="math inline">\(\mathbf{A}\)</span>, and returns the number of individuals in each age class at each time step in a data frame.</p>
<p><br></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="s03-MatrixModels.html#cb13-1" aria-hidden="true" tabindex="-1"></a>projection <span class="ot">&lt;-</span> <span class="cf">function</span>(MatA, <span class="at">Tmax =</span> <span class="dv">50</span>, n0){</span>
<span id="cb13-2"><a href="s03-MatrixModels.html#cb13-2" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="fu">dim</span>(MatA)[<span class="dv">1</span>]</span>
<span id="cb13-3"><a href="s03-MatrixModels.html#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(n0)<span class="sc">!=</span>k){</span>
<span id="cb13-4"><a href="s03-MatrixModels.html#cb13-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">warning</span>(<span class="st">&quot;n0 should have length k </span></span>
<span id="cb13-5"><a href="s03-MatrixModels.html#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="st">              corresponding to number </span></span>
<span id="cb13-6"><a href="s03-MatrixModels.html#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="st">              of stages in Amat&quot;</span>)</span>
<span id="cb13-7"><a href="s03-MatrixModels.html#cb13-7" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb13-8"><a href="s03-MatrixModels.html#cb13-8" aria-hidden="true" tabindex="-1"></a>  Nmat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow=</span> Tmax<span class="sc">+</span><span class="dv">1</span>, <span class="at">ncol=</span>k)</span>
<span id="cb13-9"><a href="s03-MatrixModels.html#cb13-9" aria-hidden="true" tabindex="-1"></a>  cnames <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;n&quot;</span>, <span class="dv">1</span><span class="sc">:</span>k, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb13-10"><a href="s03-MatrixModels.html#cb13-10" aria-hidden="true" tabindex="-1"></a>  timesteps <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span>Tmax</span>
<span id="cb13-11"><a href="s03-MatrixModels.html#cb13-11" aria-hidden="true" tabindex="-1"></a>  Nmat[<span class="dv">1</span>,] <span class="ot">=</span> n0 </span>
<span id="cb13-12"><a href="s03-MatrixModels.html#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>(Tmax<span class="sc">+</span><span class="dv">1</span>)){  </span>
<span id="cb13-13"><a href="s03-MatrixModels.html#cb13-13" aria-hidden="true" tabindex="-1"></a>    Nmat[i,] <span class="ot">=</span> MatA<span class="sc">%*%</span>Nmat[i<span class="dv">-1</span>,]</span>
<span id="cb13-14"><a href="s03-MatrixModels.html#cb13-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-15"><a href="s03-MatrixModels.html#cb13-15" aria-hidden="true" tabindex="-1"></a>  frame <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(timesteps, Nmat)</span>
<span id="cb13-16"><a href="s03-MatrixModels.html#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(frame) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;time&quot;</span>, cnames)</span>
<span id="cb13-17"><a href="s03-MatrixModels.html#cb13-17" aria-hidden="true" tabindex="-1"></a>  frame</span>
<span id="cb13-18"><a href="s03-MatrixModels.html#cb13-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><br></p>
<p>In R, the operator <span class="math inline">\(\%*\%\)</span> performs a matrix multiplication. Here this is done for each time step within a for-loop to calculate the current population vector as a function of the previous one. Note that the initial population vector <span class="math inline">\(n_0\)</span> has to have correct number of element <span class="math inline">\(k\)</span>, i.e. the same number of age classes as in the projection matrix <span class="math inline">\(\mathbf{A}\)</span>. If not you will get an error when using the function. The initial population vector is included the returned data frame (the first row).</p>
<p><br></p>
<div id="bird-example-6" class="section level4 unnumbered hasAnchor">
<h4>Bird example<a href="s03-MatrixModels.html#bird-example-6" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For the bird example (section <a href="s02-life-tables.html#bird">2.4.1</a>), we can apply the function to project the population over time. The projection matrices for a pre- or post-reproductive census were defined earlier for this example. We can use the following code to project and plot the population over time for each census type:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="s03-MatrixModels.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Return matrix of projected growth of each age class over time:</span></span>
<span id="cb14-2"><a href="s03-MatrixModels.html#cb14-2" aria-hidden="true" tabindex="-1"></a>Pop.bird.pre <span class="ot">&lt;-</span> <span class="fu">projection</span>(<span class="at">MatA=</span>Abird.pre, <span class="at">n0=</span><span class="fu">rep</span>(<span class="dv">10</span>,<span class="dv">3</span>), <span class="at">Tmax=</span><span class="dv">30</span>)</span>
<span id="cb14-3"><a href="s03-MatrixModels.html#cb14-3" aria-hidden="true" tabindex="-1"></a>Pop.bird.post <span class="ot">&lt;-</span> <span class="fu">projection</span>(<span class="at">MatA=</span>Abird.post, <span class="at">n0=</span><span class="fu">rep</span>(<span class="dv">10</span>,<span class="dv">3</span>),<span class="at">Tmax=</span><span class="dv">30</span>)</span>
<span id="cb14-4"><a href="s03-MatrixModels.html#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="s03-MatrixModels.html#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Long format for plotting:</span></span>
<span id="cb14-6"><a href="s03-MatrixModels.html#cb14-6" aria-hidden="true" tabindex="-1"></a>Pop.bird.pre.long <span class="ot">&lt;-</span> Pop.bird.pre <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="fu">c</span>(<span class="sc">-</span>time),</span>
<span id="cb14-7"><a href="s03-MatrixModels.html#cb14-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;AgeClass&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;Value&quot;</span>)</span>
<span id="cb14-8"><a href="s03-MatrixModels.html#cb14-8" aria-hidden="true" tabindex="-1"></a>Pop.bird.post.long <span class="ot">&lt;-</span> Pop.bird.post <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="fu">c</span>(<span class="sc">-</span>time),</span>
<span id="cb14-9"><a href="s03-MatrixModels.html#cb14-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;AgeClass&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;Value&quot;</span>)</span>
<span id="cb14-10"><a href="s03-MatrixModels.html#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="s03-MatrixModels.html#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Add census type and combine:</span></span>
<span id="cb14-12"><a href="s03-MatrixModels.html#cb14-12" aria-hidden="true" tabindex="-1"></a>Pop.bird.pre.long<span class="sc">$</span>census <span class="ot">&lt;-</span> <span class="st">&quot;Pre&quot;</span> </span>
<span id="cb14-13"><a href="s03-MatrixModels.html#cb14-13" aria-hidden="true" tabindex="-1"></a>Pop.bird.post.long<span class="sc">$</span>census <span class="ot">&lt;-</span> <span class="st">&quot;Post&quot;</span> </span>
<span id="cb14-14"><a href="s03-MatrixModels.html#cb14-14" aria-hidden="true" tabindex="-1"></a>Pop.bird.long <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Pop.bird.pre.long,Pop.bird.post.long)</span>
<span id="cb14-15"><a href="s03-MatrixModels.html#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="s03-MatrixModels.html#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Order levels of the census factor variables</span></span>
<span id="cb14-17"><a href="s03-MatrixModels.html#cb14-17" aria-hidden="true" tabindex="-1"></a>Pop.bird.long<span class="sc">$</span>census <span class="ot">&lt;-</span> <span class="fu">factor</span>(Pop.bird.long<span class="sc">$</span>census, </span>
<span id="cb14-18"><a href="s03-MatrixModels.html#cb14-18" aria-hidden="true" tabindex="-1"></a>                               <span class="at">levels=</span><span class="fu">c</span>(<span class="st">&quot;Pre&quot;</span>,<span class="st">&quot;Post&quot;</span>))</span>
<span id="cb14-19"><a href="s03-MatrixModels.html#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="s03-MatrixModels.html#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot</span></span>
<span id="cb14-21"><a href="s03-MatrixModels.html#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="s03-MatrixModels.html#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Pop.bird.long) <span class="sc">+</span> </span>
<span id="cb14-23"><a href="s03-MatrixModels.html#cb14-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>time,<span class="at">y=</span>Value, <span class="at">col=</span>AgeClass,</span>
<span id="cb14-24"><a href="s03-MatrixModels.html#cb14-24" aria-hidden="true" tabindex="-1"></a>                <span class="at">linetype=</span>AgeClass), <span class="at">lwd=</span><span class="fl">1.2</span>)<span class="sc">+</span></span>
<span id="cb14-25"><a href="s03-MatrixModels.html#cb14-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb14-26"><a href="s03-MatrixModels.html#cb14-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(census),<span class="at">ncol=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb14-27"><a href="s03-MatrixModels.html#cb14-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span>colors3)<span class="sc">+</span> <span class="co">#Add colors manually</span></span>
<span id="cb14-28"><a href="s03-MatrixModels.html#cb14-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>))<span class="sc">+</span> <span class="co">#Add linetypes manually</span></span>
<span id="cb14-29"><a href="s03-MatrixModels.html#cb14-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x=</span><span class="st">&quot;Time (year)&quot;</span>, <span class="at">y=</span><span class="st">&quot;Age class size&quot;</span>)<span class="sc">+</span> <span class="co">#Axis labels</span></span>
<span id="cb14-30"><a href="s03-MatrixModels.html#cb14-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span> ) <span class="co">#Place legend on top</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:birdgrowth"></span>
<img src="_main_files/figure-html/birdgrowth-1.png" alt="Projected growth of the bird example, with pre-reproductive (age class 1 consist of 1-year olds) or post-reproductive census (age class 1 consist of 0-year olds)." width="864" />
<p class="caption">
Figure 3.4: Projected growth of the bird example, with pre-reproductive (age class 1 consist of 1-year olds) or post-reproductive census (age class 1 consist of 0-year olds).
</p>
</div>
<p><br></p>
<p>Figure <a href="s03-MatrixModels.html#fig:birdgrowth">3.4</a> shows the difference between the pre-reproductive an post-reproductive census in the bird example. With pre-reproductive census the first age class consists of 1-year olds, the second class of 2-year olds and the third class of 3-year olds. With post-reproductive census the first class consists of individuals of age 0, the second of age 1 and the third of age 2. In each model we start with 10 individuals in each class, but the subsequent growth pattern is different because of how the population is counted. We see a higher number of individuals in the first class of the post reproductive census model compared to the other classes, due to high reproduction in this example.</p>
<p>Note the fluctuations in the beginning, that become smoother over time and eventually disappear. These occur because the population is started with 10 individuals in each class, which is not the stable structure of the population. The fluctuatoins are called <strong>transient fluctuations</strong> because they are temporary. After some time they become negligible, as the population reachedes a phase of <strong>stable growth</strong>, where each age class grows exponentially with the same rate <span class="math inline">\(\lambda\)</span>. In this phase the population shows <strong>asymptotic dynamics</strong>, and it will remain there unless something disturbs the stable structure. There are three properties of the population in the asymptotic phase: The long-term growth rate <span class="math inline">\(\lambda\)</span>, the stable age structure <span class="math inline">\(\mathbf{u}\)</span>, and the reproductive values <span class="math inline">\(\mathbf{v}\)</span>. The next section describes how to calculate these properties from the projected growth, while section <a href="s03-MatrixModels.html#asymptotic">3.6</a> shows how to calculate these properties from the projection matrix and its two main components. Here the different properties and their biological meaning are discussed in more detail.</p>
<p><br></p>
</div>
</div>
<div id="asymptotic" class="section level2 hasAnchor" number="3.6">
<h2><span class="header-section-number">3.6</span> Asymptotic properties<a href="s03-MatrixModels.html#asymptotic" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="projected" class="section level3 hasAnchor" number="3.6.1">
<h3><span class="header-section-number">3.6.1</span> Calculations based on projected growth<a href="s03-MatrixModels.html#projected" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>From the population projections we can now estimate <span class="math inline">\(\lambda\)</span>, the stable age structure <span class="math inline">\(\mathbf{u}\)</span>, and the reproductive values <span class="math inline">\(\mathbf{v}\)</span>, as shown in the next sections.</p>
<div id="long-term-population-growth-rate-lambda" class="section level4 unnumbered hasAnchor">
<h4>Long-term population growth rate <span class="math inline">\(\lambda\)</span>:<a href="s03-MatrixModels.html#long-term-population-growth-rate-lambda" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This is the same growth rate <span class="math inline">\(\lambda\)</span> that we have already defined based on the Euler-Lotka equation (section <a href="s02-life-tables.html#Euler">2.6.4</a>). This parameter can also be estimated from the projected population size over time, as <span class="math inline">\(\lambda=N_{T+1}/N_T\)</span> (where <span class="math inline">\(N_t=\sum_{i=1}^kn_{i,t}\)</span> is the total population size at time <span class="math inline">\(t\)</span>), after a sufficiently large number of time steps <span class="math inline">\(T\)</span> (large enough that the estimate of <span class="math inline">\(\lambda\)</span>, to a chosen number of decimal places, does not change if we increase <span class="math inline">\(T\)</span> further). It can also be estimated from any of the age classes,</p>
<p>For the bird example (here with prereproductive census), we can use the following R code:</p>
<p><br></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="s03-MatrixModels.html#cb15-1" aria-hidden="true" tabindex="-1"></a>Total.pop.bird <span class="ot">&lt;-</span> <span class="fu">apply</span>(Pop.bird.pre[<span class="sc">-</span><span class="dv">1</span>],<span class="dv">1</span>,sum) <span class="co">#Get total size</span></span>
<span id="cb15-2"><a href="s03-MatrixModels.html#cb15-2" aria-hidden="true" tabindex="-1"></a>Tmax <span class="ot">&lt;-</span> <span class="fu">length</span>(Total.pop.bird)<span class="co">#Recover max time</span></span>
<span id="cb15-3"><a href="s03-MatrixModels.html#cb15-3" aria-hidden="true" tabindex="-1"></a>lambda.bird <span class="ot">&lt;-</span> Total.pop.bird[Tmax]<span class="sc">/</span>Total.pop.bird[Tmax<span class="dv">-1</span>]</span></code></pre></div>
<p>The estimated value from projection over 31 time steps is <span class="math inline">\(\lambda\approx\)</span> 1.07027, close to the value $$1.07025 calculated from the life table in section <a href="s02-life-tables.html#Euler">2.6.4</a>. The more time steps are used for the projection and calculation, the more accurate the estimate of <span class="math inline">\(\lambda\)</span> will be.</p>
<p><br></p>
</div>
<div id="stable-age-structure" class="section level4 unnumbered hasAnchor">
<h4>Stable age structure:<a href="s03-MatrixModels.html#stable-age-structure" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The age structure is the proportion of the population constituted by each age class. As you can see from the projected growth (figure <a href="s03-MatrixModels.html#fig:birdgrowth">3.4</a>), the age structure will fluctuate in the beginning, before it approaches a <strong>stable age structure</strong> as the transient fluctuations fade out, a structure that becomes constant over time. The stable age structure is denoted by the vector <span class="math inline">\(\mathbf{u}=[u_1, u_2, ..., u_k]\)</span> (where <span class="math inline">\(\sum_{j=1}^{k} u_j=1\)</span>). This vector can be estimated from the projected population, as <span class="math inline">\(u_j\approx n_{j,T}/N_T\)</span>, where again <span class="math inline">\(T\)</span> is a (sufficiently) large number of time steps. For growing age structured populations, the age structure will always be a monotonically decreasing function of age class.</p>
<p>In R, we can also estimate the stable structure from the projections, here shown for the bird example with pre-reproductive census:</p>
<p><br></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="s03-MatrixModels.html#cb16-1" aria-hidden="true" tabindex="-1"></a>stablestructure.pre <span class="ot">&lt;-</span> Pop.bird.pre[Tmax,<span class="sc">-</span><span class="dv">1</span>]<span class="sc">/</span>Total.pop.bird[Tmax]</span>
<span id="cb16-2"><a href="s03-MatrixModels.html#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="s03-MatrixModels.html#cb16-3" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="fu">dim</span>(Abird.pre)[<span class="dv">1</span>]</span>
<span id="cb16-4"><a href="s03-MatrixModels.html#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="s03-MatrixModels.html#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(stablestructure.pre) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;u&quot;</span>,<span class="dv">1</span><span class="sc">:</span>k,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb16-6"><a href="s03-MatrixModels.html#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="s03-MatrixModels.html#cb16-7" aria-hidden="true" tabindex="-1"></a>stablestructure.pre</span></code></pre></div>
<pre><code>##           u1        u2        u3
## 31 0.4324629 0.3636527 0.2038843</code></pre>
<p><br></p>
</div>
<div id="reproductive-values" class="section level4 unnumbered hasAnchor">
<h4>Reproductive values:<a href="s03-MatrixModels.html#reproductive-values" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We can calculate the age-specific <strong>reproductive values</strong> using a slightly modified version of projected growth. The reproductive value was first defined by <span class="citation">Fisher (<a href="#ref-Fisher1" role="doc-biblioref">1930</a>)</span>, who was interested in how much individuals of each age class would contribute to the future population, compared to other age classes. We can think of the reproductive value as a return rate associated with ‘investing’ in different age classes. If we could choose individuals from just one age class to start a new population, and wanted this population to be as large as possible after some time - we should choose the age class with the highest reproductive value.</p>
<p>To calculate the reproductive values from projections, we have two options: One is to project the total population size <span class="math inline">\(k\)</span> times (where <span class="math inline">\(k\)</span> the number of age classes), and at projection number <span class="math inline">\(i\)</span> we start with a given number of individuals (e.g. 10) in age class <span class="math inline">\(i\)</span> only (and zero in the other classes). The relative differences between the projected population sizes after <span class="math inline">\(T\)</span> time steps then reflect the reproductive values. The vector <span class="math inline">\(\mathbf{v}\)</span> (a row vector) can be scaled in different ways, here we will use the scaling <span class="math inline">\(\mathbf{vu}=\sum_{j=1}^kv_ju_j=1\)</span>.</p>
<p>Another approach is to use the <em>transposed</em> Leslie matrix <span class="math inline">\(\mathbf{A}^T\)</span> (taking the transpose means ‘flipping’ the matrix over the main diagonal, so that rows and columns are switched) and do the same kind of projection as for the stable age structure before applying the scaling defined above.</p>
<p>We can use the following code to apply the second approach for the bird example (pre-reproductive model):</p>
<p><br></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="s03-MatrixModels.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Projected growth using the transpose Leslie matrix:</span></span>
<span id="cb18-2"><a href="s03-MatrixModels.html#cb18-2" aria-hidden="true" tabindex="-1"></a>Pop.bird.transpose <span class="ot">&lt;-</span> <span class="fu">projection</span>(<span class="at">MatA=</span><span class="fu">t</span>(Abird.pre), <span class="at">n0=</span><span class="fu">rep</span>(<span class="dv">10</span>,<span class="dv">3</span>)) </span>
<span id="cb18-3"><a href="s03-MatrixModels.html#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="s03-MatrixModels.html#cb18-4" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="fu">dim</span>(Abird.pre)[<span class="dv">1</span>]</span>
<span id="cb18-5"><a href="s03-MatrixModels.html#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="s03-MatrixModels.html#cb18-6" aria-hidden="true" tabindex="-1"></a>repvalues.pre <span class="ot">&lt;-</span> Pop.bird.transpose[Tmax,<span class="sc">-</span><span class="dv">1</span>]<span class="sc">/</span></span>
<span id="cb18-7"><a href="s03-MatrixModels.html#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(stablestructure.pre<span class="sc">*</span>Pop.bird.transpose[Tmax,<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb18-8"><a href="s03-MatrixModels.html#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="s03-MatrixModels.html#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(repvalues.pre) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;v&quot;</span>,<span class="dv">1</span><span class="sc">:</span>k,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb18-10"><a href="s03-MatrixModels.html#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="s03-MatrixModels.html#cb18-11" aria-hidden="true" tabindex="-1"></a>repvalues.pre</span></code></pre></div>
<pre><code>##           v1       v2       v3
## 31 0.9144873 1.087482 1.025347</code></pre>
<p>Note that the reproductive value of an age class is a relative measure (the value should always be interpreted in comparison to the other classes). If some environmental change alters the survival and fecundity in one age class, this will generally affect the reproductive value not only in this class, but in all the other age classes as well.</p>
<p><br></p>
</div>
</div>
<div id="eigen" class="section level3 hasAnchor" number="3.6.2">
<h3><span class="header-section-number">3.6.2</span> Calculations based on projection matrix<a href="s03-MatrixModels.html#eigen" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You have now seen how the Leslie matrix <span class="math inline">\(\mathbf{A}\)</span> (or its transpose) can be used to project the population over time, and how we could calculate <span class="math inline">\(\lambda\)</span>, <span class="math inline">\(\mathbf{u}\)</span> and <span class="math inline">\(\mathbf{v}\)</span> based on these projections. This method of estimation is intuitive and works well for a given model, such as our bird example, but it takes some time and is not the most efficient way to calculate these properties. A much more efficient way is to calculate these properties directly from the projection matrix <span class="math inline">\(\mathbf{A}\)</span>, using the eigenvalues and eigenvectors (socalled ‘eigen analysis’.</p>
<p>The mathematical details of these calculations are outside the scope of this introduction (see e.g. <span class="citation">Hal Caswell (<a href="#ref-Caswell1" role="doc-biblioref">2001</a>)</span> for a more detailed introduction), but they are routinely included in R packages and easily defined in custom functions as well (as we will do below). In short, given that certain properties of <span class="math inline">\(\mathbf{A}\)</span> are fulfilled (which they are for most biologically relevant matrix models), <span class="math inline">\(\lambda\)</span> is the dominant eigenvalue of <span class="math inline">\(\mathbf{A}\)</span>, <span class="math inline">\(\mathbf{u}\)</span> is the right eigenvector associated with <span class="math inline">\(\lambda\)</span>, and <span class="math inline">\(\mathbf{v}\)</span> is the left eigenvector. It is worth noting that for age-structured populations, the socalled <em>characteristic equation</em> of the matrix <span class="math inline">\(\mathbf{A}\)</span>, from which we all of these parameters are calculated, corresponds to the Euler-Lotka equation we defined in section <a href="s02-life-tables.html#Euler">2.6.4</a>.</p>
<p>The following R function takes a Leslie matrix (or any other kind of projection matrix) as the input variable, and returns the value of <span class="math inline">\(\lambda\)</span> along with the vectors <span class="math inline">\(\mathbf{u}\)</span> and <span class="math inline">\(\mathbf{v}\)</span>, using the scaling defined above.</p>
<p><br></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="s03-MatrixModels.html#cb20-1" aria-hidden="true" tabindex="-1"></a>uvlambda <span class="ot">&lt;-</span> <span class="cf">function</span>(MatA){</span>
<span id="cb20-2"><a href="s03-MatrixModels.html#cb20-2" aria-hidden="true" tabindex="-1"></a> ev <span class="ot">&lt;-</span> <span class="fu">eigen</span>(MatA)</span>
<span id="cb20-3"><a href="s03-MatrixModels.html#cb20-3" aria-hidden="true" tabindex="-1"></a> tev <span class="ot">&lt;-</span> <span class="fu">eigen</span>(<span class="fu">t</span>(MatA))</span>
<span id="cb20-4"><a href="s03-MatrixModels.html#cb20-4" aria-hidden="true" tabindex="-1"></a> lmax <span class="ot">&lt;-</span> <span class="fu">which.max</span>(<span class="fu">Re</span>(ev<span class="sc">$</span>values))</span>
<span id="cb20-5"><a href="s03-MatrixModels.html#cb20-5" aria-hidden="true" tabindex="-1"></a> U <span class="ot">&lt;-</span> ev<span class="sc">$</span>vectors</span>
<span id="cb20-6"><a href="s03-MatrixModels.html#cb20-6" aria-hidden="true" tabindex="-1"></a> V <span class="ot">&lt;-</span> tev<span class="sc">$</span>vectors</span>
<span id="cb20-7"><a href="s03-MatrixModels.html#cb20-7" aria-hidden="true" tabindex="-1"></a> u <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">abs</span>(<span class="fu">Re</span>(U[, lmax]))<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">abs</span>(<span class="fu">Re</span>(U[, lmax]))))</span>
<span id="cb20-8"><a href="s03-MatrixModels.html#cb20-8" aria-hidden="true" tabindex="-1"></a> u <span class="ot">&lt;-</span> u<span class="sc">/</span>(<span class="fu">sum</span>(u)) <span class="co">#scale u</span></span>
<span id="cb20-9"><a href="s03-MatrixModels.html#cb20-9" aria-hidden="true" tabindex="-1"></a> v <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">abs</span>(<span class="fu">Re</span>(V[, lmax])))</span>
<span id="cb20-10"><a href="s03-MatrixModels.html#cb20-10" aria-hidden="true" tabindex="-1"></a> v <span class="ot">&lt;-</span> v<span class="sc">/</span><span class="fu">sum</span>(u<span class="sc">*</span>v ) <span class="co">#scale v</span></span>
<span id="cb20-11"><a href="s03-MatrixModels.html#cb20-11" aria-hidden="true" tabindex="-1"></a> v <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">ifelse</span>(u<span class="sc">*</span>v <span class="sc">&lt;=</span> <span class="dv">0</span>, <span class="dv">0</span>, v))</span>
<span id="cb20-12"><a href="s03-MatrixModels.html#cb20-12" aria-hidden="true" tabindex="-1"></a> <span class="fu">return</span>(<span class="fu">list</span>(<span class="st">&quot;lambda&quot;</span><span class="ot">=</span><span class="fu">max</span>(<span class="fu">Re</span>(ev<span class="sc">$</span>values)),<span class="st">&quot;u&quot;</span><span class="ot">=</span>u,<span class="st">&quot;v&quot;</span><span class="ot">=</span>v))</span>
<span id="cb20-13"><a href="s03-MatrixModels.html#cb20-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div id="bird-example-7" class="section level4 unnumbered hasAnchor">
<h4>Bird example<a href="s03-MatrixModels.html#bird-example-7" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For the bird example with a pre-reproductive census, we can calculate and plot the asymptotic properties as follows:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="s03-MatrixModels.html#cb21-1" aria-hidden="true" tabindex="-1"></a>res.bird <span class="ot">&lt;-</span> <span class="fu">uvlambda</span>(Abird.pre)</span>
<span id="cb21-2"><a href="s03-MatrixModels.html#cb21-2" aria-hidden="true" tabindex="-1"></a>lambda.bird.pre <span class="ot">&lt;-</span> res.bird<span class="sc">$</span>lambda</span>
<span id="cb21-3"><a href="s03-MatrixModels.html#cb21-3" aria-hidden="true" tabindex="-1"></a>u.bird.pre <span class="ot">&lt;-</span> res.bird<span class="sc">$</span>u</span>
<span id="cb21-4"><a href="s03-MatrixModels.html#cb21-4" aria-hidden="true" tabindex="-1"></a>v.bird.bird <span class="ot">&lt;-</span> res.bird<span class="sc">$</span>v</span>
<span id="cb21-5"><a href="s03-MatrixModels.html#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="s03-MatrixModels.html#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Create data frame for plotting</span></span>
<span id="cb21-7"><a href="s03-MatrixModels.html#cb21-7" aria-hidden="true" tabindex="-1"></a>birdframe.asym <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;AgeClass&quot;</span><span class="ot">=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, </span>
<span id="cb21-8"><a href="s03-MatrixModels.html#cb21-8" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;u&quot;</span><span class="ot">=</span>u.bird.pre, </span>
<span id="cb21-9"><a href="s03-MatrixModels.html#cb21-9" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;v&quot;</span><span class="ot">=</span><span class="fu">t</span>(v.bird.bird))</span>
<span id="cb21-10"><a href="s03-MatrixModels.html#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="s03-MatrixModels.html#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Long format for plotting:</span></span>
<span id="cb21-12"><a href="s03-MatrixModels.html#cb21-12" aria-hidden="true" tabindex="-1"></a>birdframe.asym.long <span class="ot">&lt;-</span> birdframe.asym <span class="sc">%&gt;%</span> </span>
<span id="cb21-13"><a href="s03-MatrixModels.html#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(u,v),</span>
<span id="cb21-14"><a href="s03-MatrixModels.html#cb21-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;Vector&quot;</span>, </span>
<span id="cb21-15"><a href="s03-MatrixModels.html#cb21-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;Value&quot;</span>)</span>
<span id="cb21-16"><a href="s03-MatrixModels.html#cb21-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-17"><a href="s03-MatrixModels.html#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Ensure order of factor levels (for plotting)</span></span>
<span id="cb21-18"><a href="s03-MatrixModels.html#cb21-18" aria-hidden="true" tabindex="-1"></a>birdframe.asym.long<span class="sc">$</span>AgeClass <span class="ot">&lt;-</span> <span class="fu">factor</span>(birdframe.asym.long<span class="sc">$</span>AgeClass, </span>
<span id="cb21-19"><a href="s03-MatrixModels.html#cb21-19" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb21-20"><a href="s03-MatrixModels.html#cb21-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-21"><a href="s03-MatrixModels.html#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(birdframe.asym.long) <span class="sc">+</span> </span>
<span id="cb21-22"><a href="s03-MatrixModels.html#cb21-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x=</span>AgeClass, <span class="at">y=</span>Value, </span>
<span id="cb21-23"><a href="s03-MatrixModels.html#cb21-23" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill=</span>AgeClass ), <span class="at">lwd=</span><span class="fl">1.2</span>)<span class="sc">+</span></span>
<span id="cb21-24"><a href="s03-MatrixModels.html#cb21-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb21-25"><a href="s03-MatrixModels.html#cb21-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Vector), <span class="at">ncol=</span><span class="dv">2</span>, <span class="at">scales=</span><span class="st">&quot;free&quot;</span>)<span class="sc">+</span></span>
<span id="cb21-26"><a href="s03-MatrixModels.html#cb21-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span>colors3)<span class="sc">+</span> <span class="co">#Add colors manually</span></span>
<span id="cb21-27"><a href="s03-MatrixModels.html#cb21-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x=</span><span class="st">&quot;Age class&quot;</span>, <span class="at">y=</span><span class="st">&quot;Value&quot;</span>)<span class="sc">+</span> <span class="co">#Axis labels</span></span>
<span id="cb21-28"><a href="s03-MatrixModels.html#cb21-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span> ) <span class="co">#Place legend on top</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:stablerepro"></span>
<img src="_main_files/figure-html/stablerepro-1.png" alt="Stable age structure and reproductive values, calculated for the bird example with pre-reproductive census." width="864" />
<p class="caption">
Figure 3.5: Stable age structure and reproductive values, calculated for the bird example with pre-reproductive census.
</p>
</div>
<p><br></p>
<p>The calculated long-term growth rate is <span class="math inline">\(\lambda=\)</span> 1.0703 , corresponding well to the earlier result <span class="math inline">\(\lambda=\)</span> 1.0703 calculated using projection.</p>
<p>Now we can also double check that we get the same value of <span class="math inline">\(\lambda\)</span> for the pre-reproductive and post-reproductive bird models:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="s03-MatrixModels.html#cb22-1" aria-hidden="true" tabindex="-1"></a>lambda.bird.pre <span class="ot">&lt;-</span> <span class="fu">uvlambda</span>(Abird.pre)<span class="sc">$</span>lambda</span>
<span id="cb22-2"><a href="s03-MatrixModels.html#cb22-2" aria-hidden="true" tabindex="-1"></a>lambda.bird.post <span class="ot">&lt;-</span> <span class="fu">uvlambda</span>(Abird.post)<span class="sc">$</span>lambda</span>
<span id="cb22-3"><a href="s03-MatrixModels.html#cb22-3" aria-hidden="true" tabindex="-1"></a>lambdas <span class="ot">&lt;-</span> <span class="fu">c</span>(lambda.bird.pre, lambda.bird.post)</span>
<span id="cb22-4"><a href="s03-MatrixModels.html#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(lambdas) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Pre&quot;</span>, <span class="st">&quot;Post&quot;</span>)</span>
<span id="cb22-5"><a href="s03-MatrixModels.html#cb22-5" aria-hidden="true" tabindex="-1"></a>lambdas</span></code></pre></div>
<pre><code>##      Pre     Post 
## 1.070261 1.070261</code></pre>
<p><br></p>
</div>
</div>
<div id="lifetime" class="section level3 hasAnchor" number="3.6.3">
<h3><span class="header-section-number">3.6.3</span> Life expectancy<a href="s03-MatrixModels.html#lifetime" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>From the matrix <span class="math inline">\(\mathbf{U}\)</span> we can calculate the socalled fundamental matrix, from which we can find the life expectancy of each age class:</p>
<p><span class="math display" id="eq:Fundamental">\[\begin{align}
\mathbf{N}=(\mathbf{I}-\mathbf{U})^{-1},
\tag{3.8}
\end{align}\]</span>
where <span class="math inline">\(\mathbf{I}\)</span> is an identity matrix (a matrix with 1’s on the main diagonal and 0’s everywhere else) of the same dimension as <span class="math inline">\(\mathbf{F}\)</span> and <span class="math inline">\(\mathbf{U}\)</span>.</p>
<p>The column sums of this matrix provides the life expectancy (expected remaining lifetime) in each age class. The life expectancy at birth is given by the first element of the vector, if we assume a post-reproductive census model.</p>
<p>To calculate the vector of age class-specific life expectancies in R we can use the following function:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="s03-MatrixModels.html#cb24-1" aria-hidden="true" tabindex="-1"></a> LifeExpectancy <span class="ot">&lt;-</span> <span class="cf">function</span>(MatU){   </span>
<span id="cb24-2"><a href="s03-MatrixModels.html#cb24-2" aria-hidden="true" tabindex="-1"></a>  k<span class="ot">&lt;-</span><span class="fu">dim</span>(MatU)[<span class="dv">1</span>]</span>
<span id="cb24-3"><a href="s03-MatrixModels.html#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.na</span>(MatU[k,k])){</span>
<span id="cb24-4"><a href="s03-MatrixModels.html#cb24-4" aria-hidden="true" tabindex="-1"></a>    MatU[k,k]<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb24-5"><a href="s03-MatrixModels.html#cb24-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-6"><a href="s03-MatrixModels.html#cb24-6" aria-hidden="true" tabindex="-1"></a>  uDim<span class="ot">=</span><span class="fu">dim</span>(MatU)[<span class="dv">1</span>]</span>
<span id="cb24-7"><a href="s03-MatrixModels.html#cb24-7" aria-hidden="true" tabindex="-1"></a>  N <span class="ot">=</span> <span class="fu">solve</span>(<span class="fu">diag</span>(uDim[<span class="dv">1</span>])<span class="sc">-</span>MatU)   </span>
<span id="cb24-8"><a href="s03-MatrixModels.html#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colSums</span>(N)  </span>
<span id="cb24-9"><a href="s03-MatrixModels.html#cb24-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><br></p>
<div id="bird-example-8" class="section level4 unnumbered hasAnchor">
<h4>Bird example<a href="s03-MatrixModels.html#bird-example-8" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Using the post-reproductive model for the bird as an example, we get the following life expectancies:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="s03-MatrixModels.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Define MatU for the post-reproductive model:</span></span>
<span id="cb25-2"><a href="s03-MatrixModels.html#cb25-2" aria-hidden="true" tabindex="-1"></a>Ubird.post <span class="ot">&lt;-</span> Abird.post</span>
<span id="cb25-3"><a href="s03-MatrixModels.html#cb25-3" aria-hidden="true" tabindex="-1"></a>Ubird.post[<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="dv">0</span> </span>
<span id="cb25-4"><a href="s03-MatrixModels.html#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="s03-MatrixModels.html#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculate life expectancy vector</span></span>
<span id="cb25-6"><a href="s03-MatrixModels.html#cb25-6" aria-hidden="true" tabindex="-1"></a> LifeExpectancy.bird.post <span class="ot">&lt;-</span> <span class="fu">LifeExpectancy</span>(<span class="at">MatU=</span>Ubird.post)</span></code></pre></div>
<p><br></p>
<p>For the bird example (post-reproductive census), the age-specific life expectancy is [1.38, 1.9, 1] years. Note that the life expectancy in age class 2 (actual age 1) is higher than in age class 1 (age 0). This is because many individuals die during their first year. The life expectancy in age class 3 (age 2) is exactly one year, because all individuals die at age 3 (after reproducing).</p>
<p><br></p>
</div>
</div>
<div id="netrate" class="section level3 hasAnchor" number="3.6.4">
<h3><span class="header-section-number">3.6.4</span> Lifetime reproduction<a href="s03-MatrixModels.html#netrate" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Using the submatrices <span class="math inline">\(\mathbf{U}\)</span> (survival matrix) and <span class="math inline">\(\mathbf{F}\)</span> (fertility matrix), we can calculate the net reproductive rate <span class="math inline">\(R_0\)</span> (mean lifetime reproduction), as well as the expected remaining reproduction of each class.</p>
<p>These calculations depend on the ‘generation to generation projection matrix’</p>
<p><span class="math display" id="eq:RMatrix">\[\begin{align}
\mathbf{R}=\mathbf{F}(\mathbf{I}-\mathbf{U})^{-1}=\mathbf{F}\mathbf{N}
\tag{3.9}
\end{align}\]</span>
Note that the fundamental matrix (equation (eq:Fundamental)) is also included in this definition. The matrix <span class="math inline">\(\mathbf{R}\)</span> describes the generation to generation growth of each age class. The column sums of <span class="math inline">\(\mathbf{R}\)</span> represent the expected remaining lifetime reproduction of the age class (with age structure, only the first row elements will be non-zero - but in more general stage structured models with more than one type of offspring, the matrix becomes more complex). <span class="math inline">\(R_0\)</span> is the dominant eigenvalue of the matrix <span class="math inline">\(\mathbf{R}\)</span>, just like <span class="math inline">\(\lambda\)</span> is the dominant eigenvalue of <span class="math inline">\(\mathbf{A}\)</span> (remember that <span class="math inline">\(R_0\)</span> is the population growth rate per generation).</p>
<p>In R, we can use the following function to calculate <span class="math inline">\(R_0\)</span> and the column sums of the fundamental matrix, given the survival matrix <span class="math inline">\(\mathbf{U}\)</span> and the fertility matrix <span class="math inline">\(\mathbf{F}\)</span>.</p>
<p><br></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="s03-MatrixModels.html#cb26-1" aria-hidden="true" tabindex="-1"></a>R0function  <span class="ot">&lt;-</span>  <span class="cf">function</span>(MatU, MatF){</span>
<span id="cb26-2"><a href="s03-MatrixModels.html#cb26-2" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="fu">dim</span>(MatU)[[<span class="dv">1</span>]]</span>
<span id="cb26-3"><a href="s03-MatrixModels.html#cb26-3" aria-hidden="true" tabindex="-1"></a>  Rmat <span class="ot">&lt;-</span> MatF<span class="sc">%*%</span><span class="fu">solve</span>(<span class="fu">diag</span>(<span class="dv">1</span>, k, k)<span class="sc">-</span>MatU)    </span>
<span id="cb26-4"><a href="s03-MatrixModels.html#cb26-4" aria-hidden="true" tabindex="-1"></a>  Rvec <span class="ot">&lt;-</span> <span class="fu">apply</span>(Rmat,<span class="dv">2</span>,sum)</span>
<span id="cb26-5"><a href="s03-MatrixModels.html#cb26-5" aria-hidden="true" tabindex="-1"></a>  R0 <span class="ot">&lt;-</span> <span class="fu">uvlambda</span>(<span class="at">MatA=</span>Rmat)<span class="sc">$</span>lam</span>
<span id="cb26-6"><a href="s03-MatrixModels.html#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="st">&quot;R0&quot;</span><span class="ot">=</span> R0,<span class="st">&quot;Rvec&quot;</span><span class="ot">=</span> Rvec))</span>
<span id="cb26-7"><a href="s03-MatrixModels.html#cb26-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div id="bird-example-9" class="section level4 unnumbered hasAnchor">
<h4>Bird example<a href="s03-MatrixModels.html#bird-example-9" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For the bird example with a pre-reproductive census, we find these matrices and <span class="math inline">\(R_0\)</span> as follows:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="s03-MatrixModels.html#cb27-1" aria-hidden="true" tabindex="-1"></a>Ubird.pre <span class="ot">&lt;-</span> Fbird.pre <span class="ot">&lt;-</span> Abird.pre</span>
<span id="cb27-2"><a href="s03-MatrixModels.html#cb27-2" aria-hidden="true" tabindex="-1"></a>Ubird.pre[<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb27-3"><a href="s03-MatrixModels.html#cb27-3" aria-hidden="true" tabindex="-1"></a>Fbird.pre[<span class="dv">2</span>,] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb27-4"><a href="s03-MatrixModels.html#cb27-4" aria-hidden="true" tabindex="-1"></a>Fbird.pre[<span class="dv">3</span>,] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb27-5"><a href="s03-MatrixModels.html#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="s03-MatrixModels.html#cb27-6" aria-hidden="true" tabindex="-1"></a>R0.Bird <span class="ot">&lt;-</span> <span class="fu">R0function</span>(<span class="at">MatU=</span>Ubird.pre, <span class="at">MatF=</span>Fbird.pre)</span></code></pre></div>
<p><br></p>
<p>For the bird example, <span class="math inline">\(R_0\)</span> is 1.19 and the column sums (remaining lifetime reproduction of each class) are 1.19, 1.32, 1.2.</p>
<p><br></p>
</div>
</div>
<div id="gentime" class="section level3 hasAnchor" number="3.6.5">
<h3><span class="header-section-number">3.6.5</span> Generation time<a href="s03-MatrixModels.html#gentime" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can calculate another measure of generation time from the Leslie matrix and the fertility matrix, using the formula</p>
<p><span class="math display" id="eq:GTime">\[\begin{align}
G=\frac{\lambda}{\mathbf{v}\mathbf{F}\mathbf{u}}.
\tag{3.10}
\end{align}\]</span></p>
<p>This measure is slightly different from the cohort generation time defined for the life table (equation <a href="s02-life-tables.html#eq:Generation">(2.3)</a>), and it represents the average age of mothers assuming stable structure. It relies on the assumption of a stable structure, notice how both <span class="math inline">\(\mathbf{u}\)</span> and <span class="math inline">\(\mathbf{v}\)</span> are part of the formula.</p>
<p>In R, we can use the following function to calculate this measure based on the projection matrix <span class="math inline">\(\mathbf{A}\)</span> and the fertility matrix <span class="math inline">\(\mathbf{F}\)</span>:</p>
<p><br></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="s03-MatrixModels.html#cb28-1" aria-hidden="true" tabindex="-1"></a>GenTime  <span class="ot">&lt;-</span>  <span class="cf">function</span>(MatA, MatF){</span>
<span id="cb28-2"><a href="s03-MatrixModels.html#cb28-2" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">uvlambda</span>(<span class="at">MatA=</span>MatA)</span>
<span id="cb28-3"><a href="s03-MatrixModels.html#cb28-3" aria-hidden="true" tabindex="-1"></a>  lam <span class="ot">&lt;-</span> res<span class="sc">$</span>lam</span>
<span id="cb28-4"><a href="s03-MatrixModels.html#cb28-4" aria-hidden="true" tabindex="-1"></a>  u <span class="ot">&lt;-</span> res<span class="sc">$</span>u</span>
<span id="cb28-5"><a href="s03-MatrixModels.html#cb28-5" aria-hidden="true" tabindex="-1"></a>  v <span class="ot">&lt;-</span> res<span class="sc">$</span>v</span>
<span id="cb28-6"><a href="s03-MatrixModels.html#cb28-6" aria-hidden="true" tabindex="-1"></a>  lam<span class="sc">/</span>(v<span class="sc">%*%</span>MatF<span class="sc">%*%</span>u)    </span>
<span id="cb28-7"><a href="s03-MatrixModels.html#cb28-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><br></p>
<div id="bird-example-10" class="section level4 unnumbered hasAnchor">
<h4>Bird example<a href="s03-MatrixModels.html#bird-example-10" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="s03-MatrixModels.html#cb29-1" aria-hidden="true" tabindex="-1"></a>GenTimeBird <span class="ot">&lt;-</span> <span class="fu">GenTime</span>(<span class="at">MatA=</span>Abird.pre, <span class="at">MatF=</span>Fbird.pre)</span></code></pre></div>
<p>For the bird example (pre-reproductive census), the generation time is 2.53 years.</p>
<p><br></p>
</div>
</div>
</div>
<div id="sensitivity-and-elasticity-of-lambda" class="section level2 hasAnchor" number="3.7">
<h2><span class="header-section-number">3.7</span> Sensitivity and elasticity of <span class="math inline">\(\lambda\)</span><a href="s03-MatrixModels.html#sensitivity-and-elasticity-of-lambda" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We will now turn to another important concept in life history theory: the <strong>sensitivities</strong> (and <strong>elasticities</strong>) of <span class="math inline">\(\lambda\)</span> with respect to elements of the Leslie matrix. The sensitivities define the <strong>selection gradients</strong> on age-specific survival and fertility, reflecting the strength of selection on different parts of the life cycle. They also play a key role in conservation biology and in other calculations such as life table response experiments (section <a href="s03-MatrixModels.html#LTRE">3.9</a>), and population growth rate in stochastic environments (chapter <a href="Stochasticity.html#Stochasticity">5</a>).</p>
<p><br></p>
<div id="sensitivity-to-matrix-elements" class="section level3 hasAnchor" number="3.7.1">
<h3><span class="header-section-number">3.7.1</span> Sensitivity to matrix elements<a href="s03-MatrixModels.html#sensitivity-to-matrix-elements" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The sensitivity of <span class="math inline">\(\lambda\)</span> to a projection matrix element <span class="math inline">\(A_{ij}\)</span> (here <span class="math inline">\(i\)</span> refers to row and <span class="math inline">\(j\)</span> refers to column of <span class="math inline">\(\mathbf{A}\)</span>) is given by the partial derivative</p>
<p><span class="math display">\[\begin{align}
\frac{\partial  \lambda}{\partial A_{ij}}=v_{i}u_{j},
\end{align}\]</span>
where the repreoductive values are scaled so that <span class="math inline">\(\mathbf{vu}=1\)</span>.</p>
<p><br></p>
<p>We can calculate the <strong>sensitivity matrix</strong> as <span class="math inline">\(\mathbf{S}=\mathbf{(uv)^T}\)</span> (remember that <span class="math inline">\(\mathbf{u}\)</span> is a column vector and <span class="math inline">\(\mathbf{v}\)</span> is a row vector, and “T” denotes the transpose). Each element of the sensitivity matrix corresponds to the sensitivity <span class="math inline">\(S_{ij})v_{i}u_{j}\)</span>. The following R code does this calculation for a given Leslie matrix <span class="math inline">\(\mathbf{A}\)</span>, by first calculating the stable age structure and reproductive values (using our previously defined function ´uvlambda()´), and then calculating the sensitivities:</p>
<p><br></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="s03-MatrixModels.html#cb30-1" aria-hidden="true" tabindex="-1"></a>sensitivity.matrix <span class="ot">&lt;-</span> <span class="cf">function</span>(MatA, <span class="at">zeroes=</span>T){</span>
<span id="cb30-2"><a href="s03-MatrixModels.html#cb30-2" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">uvlambda</span>(<span class="at">MatA=</span>MatA)</span>
<span id="cb30-3"><a href="s03-MatrixModels.html#cb30-3" aria-hidden="true" tabindex="-1"></a>  sensmat <span class="ot">&lt;-</span> <span class="fu">t</span>(res<span class="sc">$</span>u<span class="sc">%*%</span>res<span class="sc">$</span>v)</span>
<span id="cb30-4"><a href="s03-MatrixModels.html#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (zeroes<span class="sc">==</span>T){</span>
<span id="cb30-5"><a href="s03-MatrixModels.html#cb30-5" aria-hidden="true" tabindex="-1"></a>    sensmat <span class="ot">&lt;-</span> <span class="fu">ifelse</span> (MatA<span class="sc">==</span><span class="dv">0</span>, <span class="dv">0</span>, sensmat)</span>
<span id="cb30-6"><a href="s03-MatrixModels.html#cb30-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-7"><a href="s03-MatrixModels.html#cb30-7" aria-hidden="true" tabindex="-1"></a> sensmat</span>
<span id="cb30-8"><a href="s03-MatrixModels.html#cb30-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><br></p>
<p>With the default argument <code>zeroes=T</code>, all sensitivity matrix elements that correspond to elements of <span class="math inline">\(\mathbf{A}\)</span> that are zero, are also set to zero. If we set <code>zeroes=F</code>, the function will return a sensitivity value for each element of the Leslie matrix, including the zero elements representing for instance transitions from age 2 to age 5 in one year which are clearly not realistic (one can still calculate the sensitivity of <span class="math inline">\(\lambda\)</span> for such transitions; the model does not ‘care’ about realism). Since we are usually only interested in the realistically possible transitions, it is common to set the unrealistic sensitivities to zero.</p>
<div id="bird-example-11" class="section level4 unnumbered hasAnchor">
<h4>Bird example<a href="s03-MatrixModels.html#bird-example-11" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Applying the code on the bird example with post reproductive census, we get the following sensitivity matrix:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="s03-MatrixModels.html#cb31-1" aria-hidden="true" tabindex="-1"></a>sens.mat.post <span class="ot">&lt;-</span> <span class="fu">sensitivity.matrix</span>(<span class="at">MatA=</span>Abird.post)</span>
<span id="cb31-2"><a href="s03-MatrixModels.html#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(sens.mat.post,<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##       [,1]  [,2]  [,3]
## [1,] 0.000 0.074 0.062
## [2,] 2.116 0.000 0.000
## [3,] 0.000 0.249 0.000</code></pre>
<p>We can plot the corresponding sensitivities to survival and fertility coefficients:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="s03-MatrixModels.html#cb33-1" aria-hidden="true" tabindex="-1"></a> <span class="co">#Extract fertility sensitivities:</span></span>
<span id="cb33-2"><a href="s03-MatrixModels.html#cb33-2" aria-hidden="true" tabindex="-1"></a>fert.sens <span class="ot">&lt;-</span> sens.mat.post[<span class="dv">1</span>,]</span>
<span id="cb33-3"><a href="s03-MatrixModels.html#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="s03-MatrixModels.html#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Extract survival sensitivities:</span></span>
<span id="cb33-5"><a href="s03-MatrixModels.html#cb33-5" aria-hidden="true" tabindex="-1"></a>surv.sens <span class="ot">&lt;-</span> <span class="fu">c</span>(sens.mat.post[<span class="dv">2</span>,<span class="dv">1</span>], </span>
<span id="cb33-6"><a href="s03-MatrixModels.html#cb33-6" aria-hidden="true" tabindex="-1"></a>               sens.mat.post[<span class="dv">3</span>,<span class="dv">2</span>], </span>
<span id="cb33-7"><a href="s03-MatrixModels.html#cb33-7" aria-hidden="true" tabindex="-1"></a>               sens.mat.post[<span class="dv">3</span>,<span class="dv">3</span>])  </span>
<span id="cb33-8"><a href="s03-MatrixModels.html#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="s03-MatrixModels.html#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Create data frame for plotting</span></span>
<span id="cb33-10"><a href="s03-MatrixModels.html#cb33-10" aria-hidden="true" tabindex="-1"></a>birdframe.sens <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;AgeClass&quot;</span><span class="ot">=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, </span>
<span id="cb33-11"><a href="s03-MatrixModels.html#cb33-11" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;FertilitySensitivity&quot;</span><span class="ot">=</span>fert.sens, </span>
<span id="cb33-12"><a href="s03-MatrixModels.html#cb33-12" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;SurvivalSensitivity&quot;</span><span class="ot">=</span>surv.sens)</span>
<span id="cb33-13"><a href="s03-MatrixModels.html#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="s03-MatrixModels.html#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Long format for plotting:</span></span>
<span id="cb33-15"><a href="s03-MatrixModels.html#cb33-15" aria-hidden="true" tabindex="-1"></a>birdframe.sens.long <span class="ot">&lt;-</span> birdframe.sens <span class="sc">%&gt;%</span> </span>
<span id="cb33-16"><a href="s03-MatrixModels.html#cb33-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="st">&quot;AgeClass&quot;</span>),</span>
<span id="cb33-17"><a href="s03-MatrixModels.html#cb33-17" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;SensitivityTo&quot;</span>, </span>
<span id="cb33-18"><a href="s03-MatrixModels.html#cb33-18" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;Value&quot;</span>)</span>
<span id="cb33-19"><a href="s03-MatrixModels.html#cb33-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-20"><a href="s03-MatrixModels.html#cb33-20" aria-hidden="true" tabindex="-1"></a>birdframe.sens.long<span class="sc">$</span>AgeClass <span class="ot">&lt;-</span> <span class="fu">factor</span>(birdframe.sens.long<span class="sc">$</span>AgeClass,</span>
<span id="cb33-21"><a href="s03-MatrixModels.html#cb33-21" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb33-22"><a href="s03-MatrixModels.html#cb33-22" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot</span></span>
<span id="cb33-23"><a href="s03-MatrixModels.html#cb33-23" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb33-24"><a href="s03-MatrixModels.html#cb33-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(birdframe.sens.long) <span class="sc">+</span> </span>
<span id="cb33-25"><a href="s03-MatrixModels.html#cb33-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x=</span>AgeClass, <span class="at">y=</span>Value, </span>
<span id="cb33-26"><a href="s03-MatrixModels.html#cb33-26" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill=</span>AgeClass ), <span class="at">lwd=</span><span class="fl">1.2</span>)<span class="sc">+</span></span>
<span id="cb33-27"><a href="s03-MatrixModels.html#cb33-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb33-28"><a href="s03-MatrixModels.html#cb33-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(SensitivityTo),<span class="at">ncol=</span><span class="dv">2</span> )<span class="sc">+</span></span>
<span id="cb33-29"><a href="s03-MatrixModels.html#cb33-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span>colors3)<span class="sc">+</span> <span class="co">#Add colors manually</span></span>
<span id="cb33-30"><a href="s03-MatrixModels.html#cb33-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x=</span><span class="st">&quot;Age class&quot;</span>, <span class="at">y=</span><span class="st">&quot;Sensitivity&quot;</span>)<span class="sc">+</span> <span class="co">#Axis labels</span></span>
<span id="cb33-31"><a href="s03-MatrixModels.html#cb33-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span> ) <span class="co">#Place legend on top</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:sensitivitybird1"></span>
<img src="_main_files/figure-html/sensitivitybird1-1.png" alt="Sensitivities of lambda to fertility and survival coefficients, for the bird example with post-reproductive census." width="864" />
<p class="caption">
Figure 3.6: Sensitivities of lambda to fertility and survival coefficients, for the bird example with post-reproductive census.
</p>
</div>
<p><br></p>
<p>For this example, we see that the highest sensitivities are found for the survival probabilities, and in particular the first one corresponding to survival from age 0 to 1 (since we used a post-reproductive census in this example).</p>
<p><br></p>
</div>
</div>
<div id="sensitivity-to-underlying-parameters" class="section level3 hasAnchor" number="3.7.2">
<h3><span class="header-section-number">3.7.2</span> Sensitivity to underlying parameters<a href="s03-MatrixModels.html#sensitivity-to-underlying-parameters" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can also calculate the sensitivity of <span class="math inline">\(\lambda\)</span> to underlying (lower-level) parameters in the projection matrix, by applying the chain rule of derivation. If a parameter occurs in multiple entries of the matrix, we need to sum up all the corresponding sensitivities. In general, the sensitivity of <span class="math inline">\(\lambda\)</span> to a lower level parameter <span class="math inline">\(\beta\)</span> can be defined as</p>
<p><span class="math display">\[\begin{align}
\frac{\partial \lambda}{\partial \beta}=\sum_{i,j} \frac{\partial \lambda}{\partial A_{ij}} \frac{\partial A_{ij}}{\partial \beta}.
\end{align}\]</span></p>
<p><br></p>
<p>This kind of analysis is useful in models where the matrix elements are functions of some environmental variable, like temperature. Then we can calculate the sensitivity of <span class="math inline">\(\lambda\)</span> to temperature through each matrix element (or sum up to age class), to understand more about how temperature affects fitness.</p>
<p><br></p>
<div id="bird-example-12" class="section level4 unnumbered hasAnchor">
<h4>Bird example<a href="s03-MatrixModels.html#bird-example-12" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For instance, consider the projection matrix of the bird example with a post-reproductive census (equation <a href="s03-MatrixModels.html#eq:Postrep">(3.7)</a>):</p>
<p><span class="math display">\[\begin{align}
\begin{split}
\mathbf{A}=\left[\begin{matrix} f_1 &amp; f_2 &amp;f_3  \\ s_1 &amp;0&amp;0\\ 0 &amp; s_2 &amp;0  \\  \end{matrix}\right]=\left[\begin{matrix} 0 &amp; p_1m_2 &amp;p_2m_3  \\ p_0 &amp;0&amp;0\\ 0 &amp; p_1 &amp;0  \\  \end{matrix}\right].
\end{split}
\end{align}\]</span></p>
<p>If we want to calculate the sensitivity of <span class="math inline">\(\lambda\)</span> to the parameter <span class="math inline">\(p_1\)</span> (which enters element <span class="math inline">\(A_{12}\)</span> and <span class="math inline">\(A_{32}\)</span> in the projection matrix), we get the following expression:</p>
<p><span class="math display">\[\begin{align}
\frac{\partial \lambda}{\partial p_1}&amp;=\sum_{i,j} \frac{\partial \lambda}{\partial A_{ij}} \frac{\partial A_{ij}}{\partial p_1}\\
&amp;= v_1u_2 \frac{\partial A_{12}}{\partial p_1}+ v_3u_2 \frac{\partial A_{32}}{\partial p_1}\\
&amp;= v_1u_2 m_2+ v_3u_2.
\end{align}\]</span></p>
<p>We can use the following code to calculate and plot the sensitivites of <span class="math inline">\(\lambda\)</span> to the survival probabilities and fecundities against actual age, assuming the post-reproductive census:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="s03-MatrixModels.html#cb34-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">uvlambda</span>(Abird.post)</span>
<span id="cb34-2"><a href="s03-MatrixModels.html#cb34-2" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> res<span class="sc">$</span>v</span>
<span id="cb34-3"><a href="s03-MatrixModels.html#cb34-3" aria-hidden="true" tabindex="-1"></a>u <span class="ot">&lt;-</span> res<span class="sc">$</span>u</span>
<span id="cb34-4"><a href="s03-MatrixModels.html#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="s03-MatrixModels.html#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Fecundity sensitivities m0-m1-m2-m3:</span></span>
<span id="cb34-6"><a href="s03-MatrixModels.html#cb34-6" aria-hidden="true" tabindex="-1"></a>m.sens <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, </span>
<span id="cb34-7"><a href="s03-MatrixModels.html#cb34-7" aria-hidden="true" tabindex="-1"></a>            <span class="dv">0</span>, </span>
<span id="cb34-8"><a href="s03-MatrixModels.html#cb34-8" aria-hidden="true" tabindex="-1"></a>            v[<span class="dv">1</span>]<span class="sc">*</span>u[<span class="dv">2</span>]<span class="sc">*</span>px[<span class="dv">2</span>], </span>
<span id="cb34-9"><a href="s03-MatrixModels.html#cb34-9" aria-hidden="true" tabindex="-1"></a>            v[<span class="dv">1</span>]<span class="sc">*</span>u[<span class="dv">3</span>]<span class="sc">*</span>px[<span class="dv">3</span>]) </span>
<span id="cb34-10"><a href="s03-MatrixModels.html#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="s03-MatrixModels.html#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Survival sensitivities p0-p1-p2-p3</span></span>
<span id="cb34-12"><a href="s03-MatrixModels.html#cb34-12" aria-hidden="true" tabindex="-1"></a>p.sens <span class="ot">&lt;-</span> <span class="fu">c</span>(v[<span class="dv">2</span>]<span class="sc">*</span>u[<span class="dv">1</span>], </span>
<span id="cb34-13"><a href="s03-MatrixModels.html#cb34-13" aria-hidden="true" tabindex="-1"></a>            v[<span class="dv">1</span>]<span class="sc">*</span>u[<span class="dv">2</span>]<span class="sc">*</span>mx[<span class="dv">3</span>]<span class="sc">+</span>v[<span class="dv">3</span>]<span class="sc">*</span>u[<span class="dv">2</span>], </span>
<span id="cb34-14"><a href="s03-MatrixModels.html#cb34-14" aria-hidden="true" tabindex="-1"></a>            v[<span class="dv">1</span>]<span class="sc">*</span>u[<span class="dv">3</span>]<span class="sc">*</span>mx[<span class="dv">4</span>], </span>
<span id="cb34-15"><a href="s03-MatrixModels.html#cb34-15" aria-hidden="true" tabindex="-1"></a>            <span class="dv">0</span>)</span>
<span id="cb34-16"><a href="s03-MatrixModels.html#cb34-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-17"><a href="s03-MatrixModels.html#cb34-17" aria-hidden="true" tabindex="-1"></a>sens.table.bird <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;Age&quot;</span><span class="ot">=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>, </span>
<span id="cb34-18"><a href="s03-MatrixModels.html#cb34-18" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;mSensitivity&quot;</span><span class="ot">=</span>m.sens, </span>
<span id="cb34-19"><a href="s03-MatrixModels.html#cb34-19" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;pSensitivity&quot;</span><span class="ot">=</span>p.sens)</span>
<span id="cb34-20"><a href="s03-MatrixModels.html#cb34-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-21"><a href="s03-MatrixModels.html#cb34-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-22"><a href="s03-MatrixModels.html#cb34-22" aria-hidden="true" tabindex="-1"></a><span class="co">#Long format for plotting:</span></span>
<span id="cb34-23"><a href="s03-MatrixModels.html#cb34-23" aria-hidden="true" tabindex="-1"></a>sens.table.bird.long <span class="ot">&lt;-</span> sens.table.bird <span class="sc">%&gt;%</span> </span>
<span id="cb34-24"><a href="s03-MatrixModels.html#cb34-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="st">&quot;Age&quot;</span>),</span>
<span id="cb34-25"><a href="s03-MatrixModels.html#cb34-25" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;SensitivityTo&quot;</span>, </span>
<span id="cb34-26"><a href="s03-MatrixModels.html#cb34-26" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;Value&quot;</span>)</span>
<span id="cb34-27"><a href="s03-MatrixModels.html#cb34-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-28"><a href="s03-MatrixModels.html#cb34-28" aria-hidden="true" tabindex="-1"></a>sens.table.bird.long<span class="sc">$</span>Age<span class="ot">&lt;-</span> <span class="fu">factor</span>(sens.table.bird.long<span class="sc">$</span>Age, </span>
<span id="cb34-29"><a href="s03-MatrixModels.html#cb34-29" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb34-30"><a href="s03-MatrixModels.html#cb34-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-31"><a href="s03-MatrixModels.html#cb34-31" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot</span></span>
<span id="cb34-32"><a href="s03-MatrixModels.html#cb34-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-33"><a href="s03-MatrixModels.html#cb34-33" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sens.table.bird.long) <span class="sc">+</span> </span>
<span id="cb34-34"><a href="s03-MatrixModels.html#cb34-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x=</span>Age, <span class="at">y=</span>Value, <span class="at">fill=</span>Age ), <span class="at">lwd=</span><span class="fl">1.2</span>)<span class="sc">+</span></span>
<span id="cb34-35"><a href="s03-MatrixModels.html#cb34-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb34-36"><a href="s03-MatrixModels.html#cb34-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(SensitivityTo),<span class="at">ncol=</span><span class="dv">2</span> )<span class="sc">+</span></span>
<span id="cb34-37"><a href="s03-MatrixModels.html#cb34-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span>colors4)<span class="sc">+</span> <span class="co">#Add colors manually</span></span>
<span id="cb34-38"><a href="s03-MatrixModels.html#cb34-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x=</span><span class="st">&quot;Age (years)&quot;</span>, <span class="at">y=</span><span class="st">&quot;Sensitivity&quot;</span>)<span class="sc">+</span> <span class="co">#Axis labels</span></span>
<span id="cb34-39"><a href="s03-MatrixModels.html#cb34-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span> ) <span class="co">#Place legend on top</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:sensitivitybird2"></span>
<img src="_main_files/figure-html/sensitivitybird2-1.png" alt="Sensitivities of lambda to underlying parameters of age-specific fecundity and survival probability, for the bird example with post-reproductive census." width="864" />
<p class="caption">
Figure 3.7: Sensitivities of lambda to underlying parameters of age-specific fecundity and survival probability, for the bird example with post-reproductive census.
</p>
</div>
<p><br></p>
</div>
</div>
<div id="elasticities" class="section level3 hasAnchor" number="3.7.3">
<h3><span class="header-section-number">3.7.3</span> Elasticities<a href="s03-MatrixModels.html#elasticities" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A closely related concept to sensitivity is the <strong>elasticity</strong>. The elasticity of <span class="math inline">\(\lambda\)</span> to a projection matrix element <span class="math inline">\(A_{ij}\)</span> is defined as the proportional change in <span class="math inline">\(\lambda\)</span> to a proportional change in the matrix element, and is given by</p>
<p><span class="math display">\[\begin{align}
\frac{\partial  \ln \lambda}{\partial \ln A_{ij}} =\frac{A_{ij}}{\lambda}\frac{\partial  \lambda}{\partial A_{ij}}=\frac{A_{ij}}{\lambda} v_{i}u_{j}=\frac{A_{ij}}{\lambda} S_{ij}=.
\end{align}\]</span></p>
<p>The function below returns the elasticity matrix for a given projection matrix <span class="math inline">\(\mathbf{A}\)</span>.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="s03-MatrixModels.html#cb35-1" aria-hidden="true" tabindex="-1"></a>elasticity.matrix <span class="ot">&lt;-</span> <span class="cf">function</span>(MatA, <span class="at">zeroes=</span>T){</span>
<span id="cb35-2"><a href="s03-MatrixModels.html#cb35-2" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">uvlambda</span>(<span class="at">MatA=</span>MatA)</span>
<span id="cb35-3"><a href="s03-MatrixModels.html#cb35-3" aria-hidden="true" tabindex="-1"></a>  sensmat <span class="ot">&lt;-</span> <span class="fu">t</span>(res<span class="sc">$</span>u<span class="sc">%*%</span>res<span class="sc">$</span>v)</span>
<span id="cb35-4"><a href="s03-MatrixModels.html#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (zeroes<span class="sc">==</span>T){</span>
<span id="cb35-5"><a href="s03-MatrixModels.html#cb35-5" aria-hidden="true" tabindex="-1"></a>    sensmat <span class="ot">&lt;-</span> <span class="fu">ifelse</span> (MatA<span class="sc">==</span><span class="dv">0</span>, <span class="dv">0</span>, sensmat)</span>
<span id="cb35-6"><a href="s03-MatrixModels.html#cb35-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb35-7"><a href="s03-MatrixModels.html#cb35-7" aria-hidden="true" tabindex="-1"></a> sensmat<span class="sc">*</span>MatA<span class="sc">/</span>res<span class="sc">$</span>lam </span>
<span id="cb35-8"><a href="s03-MatrixModels.html#cb35-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><br></p>
<p>The elasticity to a lower-level parameter <span class="math inline">\(\beta\)</span> can be found in a similar way, as</p>
<p><span class="math display">\[\begin{align}
\frac{\partial  \ln \lambda}{\partial \ln \beta} =\frac{\beta}{\lambda}\frac{\partial  \lambda}{\partial \beta}.
\end{align}\]</span></p>
<p><br></p>
<div id="bird-example-13" class="section level4 unnumbered hasAnchor">
<h4>Bird example<a href="s03-MatrixModels.html#bird-example-13" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Continuing with the bird example with a post-reproductive census, the elasticities to age-specific fecundity and survival probability can be found as follows, using the sensitivities found in the previous section:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="s03-MatrixModels.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Fecundity elasticities m0-m1-m2-m3:</span></span>
<span id="cb36-2"><a href="s03-MatrixModels.html#cb36-2" aria-hidden="true" tabindex="-1"></a>m.elas <span class="ot">&lt;-</span> mx<span class="sc">/</span>lambda.bird.post<span class="sc">*</span>m.sens </span>
<span id="cb36-3"><a href="s03-MatrixModels.html#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="s03-MatrixModels.html#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Survival elasticities p0-p1-p2-p3</span></span>
<span id="cb36-5"><a href="s03-MatrixModels.html#cb36-5" aria-hidden="true" tabindex="-1"></a>p.elas <span class="ot">&lt;-</span> px<span class="sc">/</span>lambda.bird.post<span class="sc">*</span>p.sens </span>
<span id="cb36-6"><a href="s03-MatrixModels.html#cb36-6" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb36-7"><a href="s03-MatrixModels.html#cb36-7" aria-hidden="true" tabindex="-1"></a>elas.table.bird <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;Age&quot;</span><span class="ot">=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb36-8"><a href="s03-MatrixModels.html#cb36-8" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;mElasticity&quot;</span><span class="ot">=</span>m.elas, </span>
<span id="cb36-9"><a href="s03-MatrixModels.html#cb36-9" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;pElasticity&quot;</span><span class="ot">=</span>p.elas)</span>
<span id="cb36-10"><a href="s03-MatrixModels.html#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="s03-MatrixModels.html#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Long format for plotting:</span></span>
<span id="cb36-12"><a href="s03-MatrixModels.html#cb36-12" aria-hidden="true" tabindex="-1"></a>elas.table.bird.long <span class="ot">&lt;-</span> elas.table.bird <span class="sc">%&gt;%</span> </span>
<span id="cb36-13"><a href="s03-MatrixModels.html#cb36-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="st">&quot;Age&quot;</span>),</span>
<span id="cb36-14"><a href="s03-MatrixModels.html#cb36-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;ElasticityTo&quot;</span>, </span>
<span id="cb36-15"><a href="s03-MatrixModels.html#cb36-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;Value&quot;</span>)</span>
<span id="cb36-16"><a href="s03-MatrixModels.html#cb36-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-17"><a href="s03-MatrixModels.html#cb36-17" aria-hidden="true" tabindex="-1"></a>elas.table.bird.long<span class="sc">$</span>Age<span class="ot">&lt;-</span> <span class="fu">factor</span>(elas.table.bird.long<span class="sc">$</span>Age, </span>
<span id="cb36-18"><a href="s03-MatrixModels.html#cb36-18" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">levels=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb36-19"><a href="s03-MatrixModels.html#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot</span></span>
<span id="cb36-20"><a href="s03-MatrixModels.html#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(elas.table.bird.long) <span class="sc">+</span> </span>
<span id="cb36-21"><a href="s03-MatrixModels.html#cb36-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x=</span>Age, <span class="at">y=</span>Value, <span class="at">fill=</span>Age ), <span class="at">lwd=</span><span class="fl">1.2</span>)<span class="sc">+</span></span>
<span id="cb36-22"><a href="s03-MatrixModels.html#cb36-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb36-23"><a href="s03-MatrixModels.html#cb36-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(ElasticityTo),<span class="at">ncol=</span><span class="dv">2</span> )<span class="sc">+</span></span>
<span id="cb36-24"><a href="s03-MatrixModels.html#cb36-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span>colors4)<span class="sc">+</span>  </span>
<span id="cb36-25"><a href="s03-MatrixModels.html#cb36-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x=</span><span class="st">&quot;Age (years)&quot;</span>, <span class="at">y=</span><span class="st">&quot;Elasticity&quot;</span>)<span class="sc">+</span>  </span>
<span id="cb36-26"><a href="s03-MatrixModels.html#cb36-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span> ) </span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:elasticitybird"></span>
<img src="_main_files/figure-html/elasticitybird-1.png" alt="Elasticities of lambda to underlying parameters of age-specific fecundity and survival probability, for the bird example with post-reproductive census." width="864" />
<p class="caption">
Figure 3.8: Elasticities of lambda to underlying parameters of age-specific fecundity and survival probability, for the bird example with post-reproductive census.
</p>
</div>
<p><br></p>
<p>Note that the elasticities of fecundities <span class="math inline">\(m_x\)</span> and survival probabilities <span class="math inline">\(p_x\)</span> are more similar than the sensitivites. This is because the elasticities represent proportional changes in <span class="math inline">\(\lambda\)</span> while sensitivities represent absolute changes, and fecundity and survival are variables with different scales. We should always keep this in mind when interpreting sensitivities (and elasticities), as an absolute change in fecundity is not the same as the same absolute change in a survival probability. Although elasticities measure proportional effects, they are not better than sensitivities in this sense (which is sometimes claimed), and still need to be interpreted carefully.</p>
<p><br></p>
</div>
</div>
</div>
<div id="senescence" class="section level2 hasAnchor" number="3.8">
<h2><span class="header-section-number">3.8</span> Senescence<a href="s03-MatrixModels.html#senescence" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The sensitivities of <span class="math inline">\(\lambda\)</span> with respect to age-specific survival and fecundities are important because (among other things) they measure selection pressures. More generally, a <strong>selection gradient</strong> of a trait (survival probability and fertility are also traits) is defined as the slope of fitness as a function of the trait. For a trait with value <span class="math inline">\(\theta\)</span>, the selection gradient is the partial derivative:</p>
<p><span class="math display">\[\begin{align}
\text{Gradient}=\frac{\partial \text{Fitness}}{\partial \theta}.
\end{align}\]</span>
If the trait is a vector, such as the vector of age-specific survival probabilities <span class="math inline">\(p_i\)</span>, the gradient is also a vector.</p>
<p>Based on the Euler-Lotka equation, <span class="citation">Hamilton (<a href="#ref-Hamilton1" role="doc-biblioref">1966</a>)</span> derived the selection gradient of <span class="math inline">\(r=\ln\lambda\)</span> on (log) age-specific survival probability <span class="math inline">\(p_x\)</span>:</p>
<p><span class="math display">\[\begin{align}
\frac{\partial r}{\partial \ln p_x}&amp;=\frac{\sum_{y=x}^ke^{-ry}l_ym_y}{T_C},
\end{align}\]</span>
where <span class="math inline">\(T_C\)</span> is the cohort generation time as defined in chapter <a href="s02-life-tables.html#s02-life-tables">2</a>. The selection gradient on age-specific fecundity <span class="math inline">\(m_x\)</span> is given by</p>
<p><span class="math display">\[\begin{align}
\frac{\partial r}{\partial m_x}&amp;=\frac{e^{-rx}l_x}{T_C}.
\end{align}\]</span>
The selection gradient on survival will decline with age <span class="math inline">\(x\)</span>, after the age at first reproduction. For fecundity, the selection gradient will usually decrease with age, except in strongly declining populations: If <span class="math inline">\(r\)</span> is sufficiently negative relative to survival probability so that the stable age distribution increases with age, then the selection gradient can increase. This situation is unlikely to be common or persist for long time periods.</p>
<p>Because the selection gradients (nearly) always decline with age, <span class="citation">Hamilton (<a href="#ref-Hamilton1" role="doc-biblioref">1966</a>)</span> concluded that senescence is inevitable for any conceivable organism. With his selection gradients, Hamilton formalized the arguments previously given regarding mutation accumulation hypothesis <span class="citation">(<a href="#ref-Medawar1" role="doc-biblioref">Medawar 1952</a>)</span>, and the antagonistic pleiotropy hypothesis <span class="citation">(<a href="#ref-Williams1" role="doc-biblioref">Williams 1957</a>)</span>. Any change in the environment that causes the selection gradients to fall off more rapidly with age should select for increased senescence, while changes that make the slope less steep should select for reduced senescence.</p>
<p><br></p>
<div id="bird-example-14" class="section level4 unnumbered hasAnchor">
<h4>Bird example<a href="s03-MatrixModels.html#bird-example-14" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We can plot these selection gradients for the bird example (note that we now use the life table from chapter <a href="s02-life-tables.html#s02-life-tables">2</a>):</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="s03-MatrixModels.html#cb37-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">uvlambda</span>(Abird.post)</span>
<span id="cb37-2"><a href="s03-MatrixModels.html#cb37-2" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">log</span>(res<span class="sc">$</span>lam)</span>
<span id="cb37-3"><a href="s03-MatrixModels.html#cb37-3" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb37-4"><a href="s03-MatrixModels.html#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Survival gradient:</span></span>
<span id="cb37-5"><a href="s03-MatrixModels.html#cb37-5" aria-hidden="true" tabindex="-1"></a>dr.dp <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">cumsum</span>(<span class="fu">rev</span>(<span class="fu">exp</span>(<span class="sc">-</span>r<span class="sc">*</span>x)<span class="sc">*</span>lx<span class="sc">*</span>mx)))<span class="sc">/</span>TC_Bird </span>
<span id="cb37-6"><a href="s03-MatrixModels.html#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="s03-MatrixModels.html#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Fecundity gradient:</span></span>
<span id="cb37-8"><a href="s03-MatrixModels.html#cb37-8" aria-hidden="true" tabindex="-1"></a>dr.dm <span class="ot">&lt;-</span>  <span class="fu">exp</span>(<span class="sc">-</span>r<span class="sc">*</span>x)<span class="sc">*</span>lx<span class="sc">/</span>TC_Bird</span>
<span id="cb37-9"><a href="s03-MatrixModels.html#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="s03-MatrixModels.html#cb37-10" aria-hidden="true" tabindex="-1"></a>bird.table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x, dr.dp, dr.dm)</span>
<span id="cb37-11"><a href="s03-MatrixModels.html#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="s03-MatrixModels.html#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="co">#long format for plotting:</span></span>
<span id="cb37-13"><a href="s03-MatrixModels.html#cb37-13" aria-hidden="true" tabindex="-1"></a>bird.table.long <span class="ot">&lt;-</span> bird.table <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="fu">c</span>( dr.dp, dr.dm),</span>
<span id="cb37-14"><a href="s03-MatrixModels.html#cb37-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;Sensitivity&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;Value&quot;</span>)</span>
<span id="cb37-15"><a href="s03-MatrixModels.html#cb37-15" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb37-16"><a href="s03-MatrixModels.html#cb37-16" aria-hidden="true" tabindex="-1"></a>bird.table.long<span class="sc">$</span>Age <span class="ot">&lt;-</span> <span class="fu">factor</span>(bird.table.long<span class="sc">$</span>x, <span class="at">levels=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb37-17"><a href="s03-MatrixModels.html#cb37-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-18"><a href="s03-MatrixModels.html#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bird.table.long) <span class="sc">+</span> </span>
<span id="cb37-19"><a href="s03-MatrixModels.html#cb37-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x=</span>Age, <span class="at">y=</span>Value , <span class="at">fill=</span>Age) , <span class="at">lwd=</span><span class="fl">1.2</span>)<span class="sc">+</span></span>
<span id="cb37-20"><a href="s03-MatrixModels.html#cb37-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Sensitivity))<span class="sc">+</span></span>
<span id="cb37-21"><a href="s03-MatrixModels.html#cb37-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span>colors4)<span class="sc">+</span></span>
<span id="cb37-22"><a href="s03-MatrixModels.html#cb37-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb37-23"><a href="s03-MatrixModels.html#cb37-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x=</span><span class="st">&quot;Age (year)&quot;</span>, <span class="at">y=</span><span class="st">&quot;Sensitivity of r&quot;</span>)<span class="sc">+</span></span>
<span id="cb37-24"><a href="s03-MatrixModels.html#cb37-24" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span> ) </span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:birdgradients"></span>
<img src="_main_files/figure-html/birdgradients-1.png" alt="Selection gradients on fecundity and survival probability in the bird example, based on the life table from chapter 2." width="864" />
<p class="caption">
Figure 3.9: Selection gradients on fecundity and survival probability in the bird example, based on the life table from chapter 2.
</p>
</div>
<p><br></p>
<p>We see that also for the bird example the selection gradients decline with age, <span class="math inline">\(\frac{\partial r}{\partial p_x}\)</span> after the age of first reproduction (here 2 years) and <span class="math inline">\(\frac{\partial r}{\partial m_x}\)</span> for all ages.</p>
<p><br></p>
</div>
<div id="the-effect-of-extrinsic-mortality-on-senescence" class="section level3 unnumbered hasAnchor">
<h3>The effect of extrinsic mortality on senescence<a href="s03-MatrixModels.html#the-effect-of-extrinsic-mortality-on-senescence" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><span class="citation">Williams (<a href="#ref-Williams1" role="doc-biblioref">1957</a>)</span> suggested that increased extrinsic mortality could be such a factor leading to steeper gradients, and that simply living in a more risky environment (e.g. with many predators) should select for more rapid senescence. This may seem intuitive, however other researchers have shown that if the extrinsic mortality is age-independent, it has no effect on the slope of the selection gradient and thus no effect on senescence <span class="citation">(<a href="#ref-Hamilton1" role="doc-biblioref">Hamilton 1966</a>; <a href="#ref-Caswell7" role="doc-biblioref">Hal Caswell 2007</a>; <a href="#ref-Wensink1" role="doc-biblioref">Wensink, Caswell, and Baudisch 2017</a>)</span>. The reason is that extra mortality will affect not only the the survivorship <span class="math inline">\(l_x\)</span>, but also parameters that depend on it such as <span class="math inline">\(r\)</span> and the stable age structure. It turns out that when the added mortality is age-independent, effects cancel each other out in the numerator and denominator of Hamilton’s selection gradient, so that there is no effect on senescence. If the extrinsic mortality is age-dependent, however (for instance if only younger individuals are exposed to increased predation), the selection gradients and senescence will also be affected. In general (and all else being equal), increased mortality in early life will then select for reduced senescence, while increased mortality in late life selects for increased senescence.</p>
<p>An associated common misconception is that senescence occurs ‘because few individuals survive to old age’, and that old-age individuals are therefore evolutionarily unimportant. This argument ignores the role of reproduction: Patterns of senescence cannot be described by declines in survivorship with age alone (the <span class="math inline">\(l_x\)</span> curve; see chapter <a href="s02-life-tables.html#s02-life-tables">2</a>), because life histories are shaped by both survival and reproduction. Think of the life history of a large tree species: Only few individuals survive from seedling to old age, yet senescence is hardly present in many of these species. Even in the hypothetical situation of a species with no mortality at all (a flat <span class="math inline">\(l_x\)</span>-curve), the selection gradients would still decline with age, because of reproduction leading to ever-increasing numbers of newborn individuals compared to older ages.</p>
<p><br></p>
</div>
</div>
<div id="LTRE" class="section level2 hasAnchor" number="3.9">
<h2><span class="header-section-number">3.9</span> Life table response experiments (LTRE)<a href="s03-MatrixModels.html#LTRE" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Sometimes we want to compare larger differences in <span class="math inline">\(\lambda\)</span> between two or more different conditions - for instance for populations living in different environments, or populations that have experienced different management treatments. The purpose of a life table response experiment (LTRE) is to understand how different projection matrix elements (or underlying parameters) have contributed to the difference in <span class="math inline">\(\lambda\)</span>. <span class="citation">Hal Caswell (<a href="#ref-Caswell1" role="doc-biblioref">2001</a>)</span>, who introduced this method, describes it in more detail. LTRE analysis is inspired by experimental approaches and analysis of variance (ANOVA), but does not require any actual experiments to take place. The ‘experiment’ can also be for instance an observed change in the projection matrix after a sudden environmental change, or a management decision.</p>
<p><br></p>
<div id="general-description-of-ltre-approach" class="section level3 hasAnchor" number="3.9.1">
<h3><span class="header-section-number">3.9.1</span> General description of LTRE approach<a href="s03-MatrixModels.html#general-description-of-ltre-approach" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To do an LTRE analysis to compare <span class="math inline">\(\lambda\)</span> in two environments, we first define a <strong>reference matrix</strong> <span class="math inline">\(\mathbf{A}^{(r)}\)</span>, defining the reference life history with growth rate <span class="math inline">\(\lambda^{(r)}\)</span>. Now assume that we want to compare this to another matrix <span class="math inline">\(\mathbf{A}^{(m)}\)</span> for the same species, where the vital rates are different e.g. because of some environmental impact. This matrix is called a <strong>treatment matrix</strong> and has a corresponding <span class="math inline">\(\lambda^{(m)}\)</span>. We want to understand how much of the difference between <span class="math inline">\(\lambda^{(m)}-\lambda^{(r)}\)</span> is coming from each vital rate. To do this, we first define two useful matrices <span class="citation">(<a href="#ref-Caswell1" role="doc-biblioref">Hal Caswell 2001</a>)</span>:</p>
<ul>
<li><p><span class="math inline">\(\mathbf{A}^*=\frac{1}{2}\left(\mathbf{A}^{(m)}+\mathbf{A}^{(r)}\right)\)</span> defines the ‘halfway matrix’, i.e. a matrix where each element is the average of the corresponding elements in <span class="math inline">\(\mathbf{A}^{(m)}\)</span> and <span class="math inline">\(\mathbf{A}^{(r)}\)</span>.</p></li>
<li><p><span class="math inline">\(\mathbf{D}=\mathbf{A}^{(m)}-\mathbf{A}^{(r)}\)</span> is the ‘difference matrix’, where each element corresponds to the
difference between the corresponding elements in <span class="math inline">\(\mathbf{A}^{(m)}\)</span> and <span class="math inline">\(\mathbf{A}^{(r)}\)</span>.</p></li>
</ul>
<p>Now we can write <span class="math inline">\(\lambda^{(m)}\)</span> as a function of <span class="math inline">\(\lambda^{(r)}\)</span> (the reference value), plus a sum of difference contributions from each matrix element, weighted by the senstivity of <span class="math inline">\(\lambda\)</span> to that element <span class="citation">(<a href="#ref-Caswell1" role="doc-biblioref">Hal Caswell 2001</a>)</span>:</p>
<p><span class="math display" id="eq:LTREeq">\[\begin{align}
\lambda^{(m)}\approx \lambda^{(r)}+\sum_{i,j}d_{ij}\left.\frac{\partial\lambda}{\partial a_{ij}}\right|_{\mathbf{A}^*},
\tag{3.11}
\end{align}\]</span></p>
<p>where the sensitivities are calculated for the matrix <span class="math inline">\(\mathbf{A}^*\)</span>. A common output of such an analysis is to plot these contributions side by side. Doing a life table response analysis for <span class="math inline">\(\lambda\)</span> involves the following steps:</p>
<ol style="list-style-type: decimal">
<li><p>Define all the relevant projection matrices for each treatment / environment and define a reference matrix, and calculate <span class="math inline">\(\lambda\)</span> for each.</p></li>
<li><p>Calculate <span class="math inline">\(\mathbf{A}^*\)</span> and <span class="math inline">\(\mathbf{D}\)</span>,</p></li>
<li><p>Calculate the sensitivity matrix corresponding to the matrix <span class="math inline">\(\mathbf{A}^*\)</span>,</p></li>
<li><p>Calculate the contributions from each vital rate to the difference in <span class="math inline">\(\lambda\)</span> according to the sum defined above.</p></li>
</ol>
<p>Note that LTRE analyses can also be done for more than one comparison environment, using the same approach as described here.</p>
<p><br></p>
</div>
<div id="ltre-and-sensitivity-analyses" class="section level3 hasAnchor" number="3.9.2">
<h3><span class="header-section-number">3.9.2</span> LTRE and sensitivity analyses<a href="s03-MatrixModels.html#ltre-and-sensitivity-analyses" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>An LTRE analysis is <em>retrospective</em>, aiming to explain observed differences in <span class="math inline">\(\lambda\)</span>, while the sensitivity analysis is <em>prospective</em>, aiming to explain potential future responses of <span class="math inline">\(\lambda\)</span> to perturbations of the matrix elements <span class="citation">(<a href="#ref-Caswell1" role="doc-biblioref">Hal Caswell 2001</a>)</span>. The two can give very different answers in terms of which matrix element is the ‘most important’ (largest sensitivity or largest LTRE contribution).</p>
<p><br></p>
<div id="bird-example-15" class="section level4 unnumbered hasAnchor">
<h4>Bird example<a href="s03-MatrixModels.html#bird-example-15" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We can demonstrate the LTRE analysis using the bird example. Here we will again assume a pre-reproductive census (you can do the same analysis for the post-reproductive model). The matrix defined in equation <a href="s03-MatrixModels.html#eq:Prerep">(3.6)</a> is now the reference matrix:</p>
<p><br>
<span class="math display">\[\begin{align*}
\mathbf{A}^{(r)}=\left[\begin{matrix} 0 &amp;0.6 &amp;1.2  \\ 0.9 &amp;0&amp;0\\ 0 &amp; 0.6 &amp;0  \\  \end{matrix}\right].
\end{align*}\]</span></p>
<p><br></p>
<p>Remember that with this projection matrix we get a value of <span class="math inline">\(\lambda^{(r)}\approx\)</span> 1.07.</p>
<p>Now assume that the bird was affected by increased predation, leading to a different projection matrix</p>
<p><br></p>
<p><span class="math display">\[\begin{align*}
\mathbf{A}^{(m)}=\left[\begin{matrix} 0 &amp;0.4 &amp;1   \\ 0.8 &amp;0&amp;0\\ 0 &amp; 0.4 &amp;0  \\  \end{matrix}\right].
\end{align*}\]</span></p>
<p><br></p>
<p>For this treatment matrix we can calculate the following value of <span class="math inline">\(\lambda^{(m)}\)</span> and its difference to the reference:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="s03-MatrixModels.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Reference matrix:</span></span>
<span id="cb38-2"><a href="s03-MatrixModels.html#cb38-2" aria-hidden="true" tabindex="-1"></a>AmatBirdR <span class="ot">&lt;-</span>  Abird.pre </span>
<span id="cb38-3"><a href="s03-MatrixModels.html#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="s03-MatrixModels.html#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Define treatment matrix:</span></span>
<span id="cb38-5"><a href="s03-MatrixModels.html#cb38-5" aria-hidden="true" tabindex="-1"></a>AmatBirdM <span class="ot">&lt;-</span> <span class="fu">Create.Amat</span>(<span class="at">Svec=</span><span class="fu">c</span>(.<span class="dv">8</span>,.<span class="dv">5</span>,.<span class="dv">0</span>), <span class="at">Fvec=</span><span class="fu">c</span>(<span class="dv">0</span>,.<span class="dv">5</span>,<span class="dv">1</span> ))  </span>
<span id="cb38-6"><a href="s03-MatrixModels.html#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="s03-MatrixModels.html#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Lambda in reference environment:</span></span>
<span id="cb38-8"><a href="s03-MatrixModels.html#cb38-8" aria-hidden="true" tabindex="-1"></a>lambdaR<span class="ot">&lt;-</span> <span class="fu">uvlambda</span>(AmatBirdR)<span class="sc">$</span>lam</span>
<span id="cb38-9"><a href="s03-MatrixModels.html#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="s03-MatrixModels.html#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Lambda in treatment environment</span></span>
<span id="cb38-11"><a href="s03-MatrixModels.html#cb38-11" aria-hidden="true" tabindex="-1"></a>lambdaM <span class="ot">&lt;-</span> <span class="fu">uvlambda</span>(AmatBirdM)<span class="sc">$</span>lam </span>
<span id="cb38-12"><a href="s03-MatrixModels.html#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="s03-MatrixModels.html#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Difference in lambda:</span></span>
<span id="cb38-14"><a href="s03-MatrixModels.html#cb38-14" aria-hidden="true" tabindex="-1"></a>lamDiff <span class="ot">&lt;-</span> lambdaM<span class="sc">-</span>lambdaR</span></code></pre></div>
<p><br></p>
<p>In the environment with increased predation, we get <span class="math inline">\(\lambda^{(m)}\approx\)</span> 0.915. This leads to a quite large difference of <span class="math inline">\(\lambda^{(m)}-\lambda^{(r)}\approx\)</span> -0.155. Now we are interested in which matrix element contributes the most to this difference in <span class="math inline">\(\lambda\)</span>.</p>
<p>First we calculate the halway matrix and difference matrix:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="s03-MatrixModels.html#cb39-1" aria-hidden="true" tabindex="-1"></a>HalfwaymatBird <span class="ot">&lt;-</span> (AmatBirdM<span class="sc">+</span>AmatBirdR)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb39-2"><a href="s03-MatrixModels.html#cb39-2" aria-hidden="true" tabindex="-1"></a>DiffmatBird <span class="ot">&lt;-</span> AmatBirdM<span class="sc">-</span>AmatBirdR</span>
<span id="cb39-3"><a href="s03-MatrixModels.html#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="s03-MatrixModels.html#cb39-4" aria-hidden="true" tabindex="-1"></a>DiffmatBird</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]  0.0 -0.1 -0.2
## [2,] -0.1  0.0  0.0
## [3,]  0.0 -0.1  0.0</code></pre>
<p><br></p>
<p>The largest difference is found for the fertility of age class 3. But this is not necessarily the element contributing the most to the difference in <span class="math inline">\(\lambda\)</span>.</p>
<p>To calculate the contributions to <span class="math inline">\(\lambda\)</span> we first need the sensitivity matrix calcalated for the halfway matrix <span class="math inline">\(\mathbf{A^*}\)</span>. Then we can apply equation <a href="s03-MatrixModels.html#eq:LTREeq">(3.11)</a> and plot the components of this sum:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="s03-MatrixModels.html#cb41-1" aria-hidden="true" tabindex="-1"></a>SensHalfwaymatBird <span class="ot">&lt;-</span> <span class="fu">sensitivity.matrix</span>(HalfwaymatBird)</span>
<span id="cb41-2"><a href="s03-MatrixModels.html#cb41-2" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb41-3"><a href="s03-MatrixModels.html#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co">#LTRE contributions:</span></span>
<span id="cb41-4"><a href="s03-MatrixModels.html#cb41-4" aria-hidden="true" tabindex="-1"></a>LTREMat <span class="ot">&lt;-</span> DiffmatBird<span class="sc">*</span>SensHalfwaymatBird</span>
<span id="cb41-5"><a href="s03-MatrixModels.html#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="s03-MatrixModels.html#cb41-6" aria-hidden="true" tabindex="-1"></a>FertilityContributions <span class="ot">&lt;-</span> LTREMat[<span class="dv">1</span>,]</span>
<span id="cb41-7"><a href="s03-MatrixModels.html#cb41-7" aria-hidden="true" tabindex="-1"></a>SurvivalContributions <span class="ot">&lt;-</span> <span class="fu">c</span>(LTREMat[<span class="dv">2</span>,<span class="dv">1</span>], </span>
<span id="cb41-8"><a href="s03-MatrixModels.html#cb41-8" aria-hidden="true" tabindex="-1"></a>                           LTREMat[<span class="dv">3</span>,<span class="dv">2</span>], </span>
<span id="cb41-9"><a href="s03-MatrixModels.html#cb41-9" aria-hidden="true" tabindex="-1"></a>                           LTREMat[<span class="dv">3</span>,<span class="dv">3</span>])</span>
<span id="cb41-10"><a href="s03-MatrixModels.html#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="s03-MatrixModels.html#cb41-11" aria-hidden="true" tabindex="-1"></a>LTRE.table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">AgeClass=</span><span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), </span>
<span id="cb41-12"><a href="s03-MatrixModels.html#cb41-12" aria-hidden="true" tabindex="-1"></a>                         FertilityContributions, </span>
<span id="cb41-13"><a href="s03-MatrixModels.html#cb41-13" aria-hidden="true" tabindex="-1"></a>                         SurvivalContributions)</span>
<span id="cb41-14"><a href="s03-MatrixModels.html#cb41-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-15"><a href="s03-MatrixModels.html#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="co">#long format for plotting:</span></span>
<span id="cb41-16"><a href="s03-MatrixModels.html#cb41-16" aria-hidden="true" tabindex="-1"></a>LTRE.table.long <span class="ot">&lt;-</span> LTRE.table <span class="sc">%&gt;%</span> </span>
<span id="cb41-17"><a href="s03-MatrixModels.html#cb41-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>( FertilityContributions, </span>
<span id="cb41-18"><a href="s03-MatrixModels.html#cb41-18" aria-hidden="true" tabindex="-1"></a>                  SurvivalContributions),</span>
<span id="cb41-19"><a href="s03-MatrixModels.html#cb41-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;Component&quot;</span>, </span>
<span id="cb41-20"><a href="s03-MatrixModels.html#cb41-20" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;Value&quot;</span>)</span>
<span id="cb41-21"><a href="s03-MatrixModels.html#cb41-21" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb41-22"><a href="s03-MatrixModels.html#cb41-22" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(LTRE.table.long) <span class="sc">+</span> </span>
<span id="cb41-23"><a href="s03-MatrixModels.html#cb41-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x=</span>AgeClass, <span class="at">y=</span>Value, <span class="at">fill=</span>AgeClass), <span class="at">lwd=</span><span class="fl">1.2</span>)<span class="sc">+</span></span>
<span id="cb41-24"><a href="s03-MatrixModels.html#cb41-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Component))<span class="sc">+</span></span>
<span id="cb41-25"><a href="s03-MatrixModels.html#cb41-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span>colors3)<span class="sc">+</span></span>
<span id="cb41-26"><a href="s03-MatrixModels.html#cb41-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb41-27"><a href="s03-MatrixModels.html#cb41-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x=</span><span class="st">&quot;Age class&quot;</span>, <span class="at">y=</span><span class="st">&quot;Contribution to lambda difference&quot;</span>)<span class="sc">+</span></span>
<span id="cb41-28"><a href="s03-MatrixModels.html#cb41-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span> ) </span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:birdLTRE"></span>
<img src="_main_files/figure-html/birdLTRE-1.png" alt="LTRE components for the bird example, corresponding to fertility and survival coefficients in the prereproductive census model, compared to an alternative model with increased predation. " width="864" />
<p class="caption">
Figure 3.10: LTRE components for the bird example, corresponding to fertility and survival coefficients in the prereproductive census model, compared to an alternative model with increased predation.
</p>
</div>
<p><br></p>
<p>Here we see that the element contribution most to the difference <span class="math inline">\(\lambda^{(m)}-\lambda^{(r)}\)</span> is the survival probability of age class 1, followed by fertility of age class 3, survival of age class 2, and fertility of age class 2.</p>
<p>We can check the approximation by summing up the LTRE contributions:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="s03-MatrixModels.html#cb42-1" aria-hidden="true" tabindex="-1"></a>sumDiff <span class="ot">&lt;-</span> <span class="fu">sum</span>(LTREMat)</span>
<span id="cb42-2"><a href="s03-MatrixModels.html#cb42-2" aria-hidden="true" tabindex="-1"></a>Vek <span class="ot">&lt;-</span> <span class="fu">c</span>(lamDiff, sumDiff)</span>
<span id="cb42-3"><a href="s03-MatrixModels.html#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Vek) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Exact&quot;</span>, <span class="st">&quot;LTREsum&quot;</span>)</span>
<span id="cb42-4"><a href="s03-MatrixModels.html#cb42-4" aria-hidden="true" tabindex="-1"></a>Vek</span></code></pre></div>
<pre><code>##      Exact    LTREsum 
## -0.1552903 -0.1552733</code></pre>
<p>These values are quite similar, indicating that the LTRE approximation is ok.</p>
<p>In this example predation had a negative effect on projection matrix elements, but it is often the case that the effect of a perturbation is negative on some elements, and positive on others. The total difference in <span class="math inline">\(\lambda\)</span> can then be quite small despite large effects on each matrix element, and an LTRE analysis is important to reveal the opposing effects.</p>
<p><br></p>
</div>
</div>
</div>
<div id="exercises-2" class="section level2 hasAnchor" number="3.10">
<h2><span class="header-section-number">3.10</span> Exercises<a href="s03-MatrixModels.html#exercises-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For suggested solutions, see appendix <a href="s09-Solutions.html#s09-Solutions">A</a>.</p>
<p><br></p>
<div id="exercise-3.1" class="section level3 unnumbered hasAnchor">
<h3>Exercise 3.1<a href="s03-MatrixModels.html#exercise-3.1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Draw the post-reproductive life cycle graph for the bird example (projection matrix shown in equation <a href="s03-MatrixModels.html#eq:Postrep">(3.7)</a>).</p>
<p><br></p>
</div>
<div id="exercise-3.2" class="section level3 unnumbered hasAnchor">
<h3>Exercise 3.2<a href="s03-MatrixModels.html#exercise-3.2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Start with the complete life table you calculated in Exercise 2.2.</p>
<ol style="list-style-type: decimal">
<li><p>Draw a life cycle graph for this population (on paper or using a drawing program), assuming a <strong>pre-reproductive census</strong>.</p></li>
<li><p>Calculate the vector of fertility coefficients <span class="math inline">\(f_i\)</span> and survival probabilities <span class="math inline">\(s_i\)</span>, assuming a pre-reproductive census.</p></li>
<li><p>Define the Leslie matrix <span class="math inline">\(\mathbf{A}\)</span> in R for this population (still assuming pre-reproductive census), as well as its two components <span class="math inline">\(\mathbf{U}\)</span> and <span class="math inline">\(\mathbf{F}\)</span>.</p></li>
<li><p>Use the Leslie matrix to project the growth of each age class over 30 time steps, and plot the result.</p></li>
<li><p>Calculate the long-term growth rate <span class="math inline">\(\lambda\)</span>, the net reproductive rate <span class="math inline">\(R_0\)</span> and the generation time <span class="math inline">\(\mathbf{G}\)</span> using the three matrices you defined in task 3. Do you get the same values as in exercise 2.2? If not, can you explain the difference?</p></li>
<li><p>Calculate and plot the stable age structure <span class="math inline">\(\mathbf{u}\)</span> and reproductive values <span class="math inline">\(\mathbf{v}\)</span> for the population. Explain the biological meaning of the results.</p></li>
<li><p>Assume that you could increase reproduction by multiplying the entire vector of fecundities <span class="math inline">\(m_x\)</span> by some constant factor <span class="math inline">\(c\)</span>. How large should this factor be to achieve a long-term growth rate <span class="math inline">\(\lambda\)</span> above 1? Update the three matrices <span class="math inline">\(\mathbf{A}\)</span>, <span class="math inline">\(\mathbf{U}\)</span> and <span class="math inline">\(\mathbf{F}\)</span> using the new fecundity values (give them new names in R) and do the same analysis as above for the new model. What happened to <span class="math inline">\(R_0\)</span> and <span class="math inline">\(G\)</span>? How did the resulting stable structure and reproductive values change?</p></li>
<li><p>This time increase the annual survival probability vector <span class="math inline">\(p_x\)</span> by some factor, instead of <span class="math inline">\(m_x\)</span>, to get a <span class="math inline">\(\lambda&gt;1\)</span>. Is the resulting survival probability vector biologically realistic? Why/why not?</p></li>
<li><p>Do the exercise of point 1-8 again, but this time change from a pre-reproductive to post-reproductive census model. Which results have now changed, and which have not?</p></li>
</ol>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Caswell1" class="csl-entry">
Caswell, Hal. 2001. <em>Matrix Population Models</em>. 2nd ed. Sunderland, Massachusetts: Sinauer Associates.
</div>
<div id="ref-Caswell7" class="csl-entry">
———. 2007. <span>“Extrinsic Mortality and the Evolution of Senescence.”</span> <em>Trends Ecol. Evol.</em> 22: 173–74.
</div>
<div id="ref-Fisher1" class="csl-entry">
Fisher, Ronald Aylmer. 1930. <em>The Genetical Theory of Natural Selection</em>. Oxford: Clarendon Press.
</div>
<div id="ref-Hamilton1" class="csl-entry">
Hamilton, W. D. 1966. <span>“The Moulding of Senescence by Natural Selection.”</span> <em>J. Theor. Biol.</em> 12: 12–45.
</div>
<div id="ref-Kendall8" class="csl-entry">
Kendall, Bruce E., M. Fujiwara, J. Diaz-Lopez, S. Schneider, J. Voigt, and S. Wiesner. 2019. <span>“Persistent Problems in the Construction of Matrix Population Models.”</span> <em>Ecol. Model.</em> 406: 33–43.
</div>
<div id="ref-Leslie1" class="csl-entry">
Leslie, P. H. 1945. <span>“On the Use of Matrices in Certain Population Mathematics.”</span> <em>Biometrika</em> 33: 183–212.
</div>
<div id="ref-Leslie2" class="csl-entry">
———. 1948. <span>“Some Further Notes on the Use of Matrices in Population Mathematics.”</span> <em>Biometrika</em> 35: 213–45.
</div>
<div id="ref-Medawar1" class="csl-entry">
Medawar, Peter Brian. 1952. <em>An Unsolved Problem of Biology</em>. London: M. K. Lewis.
</div>
<div id="ref-Wensink1" class="csl-entry">
Wensink, Maarten J., H. Caswell, and Annette Baudisch. 2017. <span>“The Rarity of Survival to Old Age Does Not Drive the Evolution of Senescence.”</span> <em>J. Evol. Biol.</em> 44: 5–10.
</div>
<div id="ref-Williams1" class="csl-entry">
Williams, George C. 1957. <span>“Pleiotropy, Natural Selection, and the Evolution of Senescence.”</span> <em>Evolution</em> 11: 398–411.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="s02-life-tables.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="s04-Stage.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
